!function(e){if("function"==typeof bootstrap)bootstrap("xmpp",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeXMPP=e}else"undefined"!=typeof window?window.XMPP=e():global.XMPP=e()}(function(){var define,ses,bootstrap,module,exports;return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o=typeof require=="function"&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}var r=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module,exports){exports.stanza=require("./lib/stanza/stanza");exports.Stream=require("./lib/stanza/stream");exports.Message=require("./lib/stanza/message");exports.Presence=require("./lib/stanza/presence");exports.Iq=require("./lib/stanza/iq");exports.SOX=require("./lib/stanza/sox");exports.Jingle=require("./lib/stanza/jingle");exports.RTP=require("./lib/stanza/rtp");exports.ICEUDP=require("./lib/stanza/iceUdp");exports.Client=require("./lib/client");exports.createClient=function(opts){var client=new exports.Client(opts);client.use(require("./lib/plugins/disco"));client.use(require("./lib/plugins/chatstates"));client.use(require("./lib/plugins/delayed"));client.use(require("./lib/plugins/forwarding"));client.use(require("./lib/plugins/carbons"));client.use(require("./lib/plugins/time"));client.use(require("./lib/plugins/mam"));client.use(require("./lib/plugins/receipts"));client.use(require("./lib/plugins/idle"));client.use(require("./lib/plugins/correction"));client.use(require("./lib/plugins/attention"));client.use(require("./lib/plugins/version"));client.use(require("./lib/plugins/invisible"));client.use(require("./lib/plugins/muc"));client.use(require("./lib/plugins/webrtc"));return client}},{"./lib/stanza/stanza":2,"./lib/stanza/stream":3,"./lib/stanza/message":4,"./lib/stanza/presence":5,"./lib/stanza/iq":6,"./lib/stanza/sox":7,"./lib/stanza/jingle":8,"./lib/stanza/rtp":9,"./lib/stanza/iceUdp":10,"./lib/client":11,"./lib/plugins/disco":12,"./lib/plugins/chatstates":13,"./lib/plugins/delayed":14,"./lib/plugins/forwarding":15,"./lib/plugins/carbons":16,"./lib/plugins/time":17,"./lib/plugins/mam":18,"./lib/plugins/receipts":19,"./lib/plugins/idle":20,"./lib/plugins/correction":21,"./lib/plugins/attention":22,"./lib/plugins/version":23,"./lib/plugins/invisible":24,"./lib/plugins/muc":25,"./lib/plugins/webrtc":26}],3:[function(require,module,exports){var stanza=require("./stanza");function Stream(data,xml){return stanza.init(this,xml,data)}Stream.prototype={constructor:{value:Stream},_name:"stream",NS:"http://etherx.jabber.org/streams",EL:"stream",toString:stanza.toString,toJSON:stanza.toJSON,get lang(){return this.xml.getAttributeNS(stanza.XML_NS,"lang")||""},set lang(value){this.xml.setAttributeNS(stanza.XML_NS,"lang",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)},get version(){return this.xml.getAttribute("version")||"1.0"},set version(value){this.xml.setAttribute("version",value)},get to(){return this.xml.getAttribute("to")||""},set to(value){this.xml.setAttribute("to",value)},get from(){return this.xml.getAttribute("from")||""},set from(value){this.xml.setAttribute("from",value)}};module.exports=Stream},{"./stanza":2}],6:[function(require,module,exports){var stanza=require("./stanza");function Iq(data,xml){return stanza.init(this,xml,data)}Iq.prototype={constructor:{value:Iq},_name:"iq",NS:"jabber:client",EL:"iq",toString:stanza.toString,toJSON:stanza.toJSON,resultReply:function(data){data.to=this.from;data.id=this.id;data.type="result";return new Iq(data)},errorReply:function(data){data.to=this.from;data.id=this.id;data.type="error";return new Iq(data)},get lang(){return this.xml.getAttributeNS(stanza.XML_NS,"lang")||""},set lang(value){this.xml.setAttributeNS(stanza.XML_NS,"lang",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)},get to(){return this.xml.getAttribute("to")||""},set to(value){this.xml.setAttribute("to",value)},get from(){return this.xml.getAttribute("from")||""},set from(value){this.xml.setAttribute("from",value)},get type(){return this.xml.getAttribute("type")||""},set type(value){this.xml.setAttribute("type",value)}};stanza.topLevel(Iq);module.exports=Iq},{"./stanza":2}],13:[function(require,module,exports){var stanzas=require("../stanza/chatstates");module.exports=function(client){client.disco.addFeature("","http://jabber.org/protocol/chatstates")}},{"../stanza/chatstates":27}],14:[function(require,module,exports){var stanzas=require("../stanza/delayed");module.exports=function(client){client.disco.addFeature("","urn:xmpp:delay")}},{"../stanza/delayed":28}],15:[function(require,module,exports){var stanzas=require("../stanza/forwarded");module.exports=function(client){client.disco.addFeature("","urn:xmpp:forward:0")}},{"../stanza/forwarded":29}],16:[function(require,module,exports){var stanzas=require("../stanza/carbons");module.exports=function(client){client.disco.addFeature("","urn:xmpp:carbons:2");client.enableCarbons=function(cb){this.sendIq({type:"set",enableCarbons:true},cb)};client.disableCarbons=function(cb){this.sendIq({type:"set",disableCarbons:true},cb)};client.on("message",function(msg){if(msg._extensions.carbonSent){return client.emit("carbon:sent",msg)}if(msg._extensions.carbonReceived){return client.emit("carbon:received",msg)}})}},{"../stanza/carbons":30}],17:[function(require,module,exports){var stanzas=require("../stanza/time");module.exports=function(client){client.disco.addFeature("","urn:xmpp:time");client.getTime=function(jid,cb){this.sendIq({to:jid,type:"get",time:true},cb)};client.on("iq:get:time",function(iq){var time=new Date;client.sendIq(iq.resultReply({time:{utc:time,tzo:time.getTimezoneOffset()}}))})}},{"../stanza/time":31}],18:[function(require,module,exports){var stanzas=require("../stanza/mam");module.exports=function(client){client.disco.addFeature("","urn:xmpp:mam:tmp");client.getHistory=function(opts,cb){var queryid=this.nextId(),self=this;opts=opts||{};opts.queryid=queryid;var mamResults=[];this.on("mam:"+queryid,"session",function(msg){mamResults.push(msg)});cb=cb||function(){};this.sendIq({type:"get",id:queryid,mamQuery:opts},function(err,resp){if(err){cb(err)}else{self.off("mam:"+queryid);resp.mamQuery.results=mamResults;cb(null,resp)}})};client.on("message",function(msg){if(msg._extensions.mam){client.emit("mam:"+msg.mam.queryid,msg)}})}},{"../stanza/mam":32}],19:[function(require,module,exports){var stanzas=require("../stanza/receipts");module.exports=function(client){client.disco.addFeature("","urn:xmpp:receipts");client.on("message",function(msg){var ackTypes={normal:true,chat:true,headline:true};if(ackTypes[msg.type]&&msg.requestReceipt&&!msg._extensions.receipt){client.sendMessage({to:msg.from,receipt:{id:msg.id},id:msg.id})}if(msg._extensions.receipt){client.emit("receipt:"+msg.receipt.id)}})}},{"../stanza/receipts":33}],20:[function(require,module,exports){var stanzas=require("../stanza/idle");module.exports=function(client){client.disco.addFeature("","urn:xmpp:idle:0")}},{"../stanza/idle":34}],21:[function(require,module,exports){var stanzas=require("../stanza/replace");module.exports=function(client){client.disco.addFeature("","urn:xmpp:message-correct:0");client.on("message",function(msg){if(msg.replace){client.emit("replace:"+msg.id,msg)}})}},{"../stanza/replace":35}],22:[function(require,module,exports){require("../stanza/attention");module.exports=function(client){client.disco.addFeature("","urn:xmpp:attention:0");client.getAttention=function(jid,opts){opts.to=jid;opts.type="headline";opts.attention=true;client.sendMessage(opts)};client.on("message",function(msg){if(msg._extensions._attention){client.emit("attention",msg)}})}},{"../stanza/attention":36}],23:[function(require,module,exports){require("../stanza/version");module.exports=function(client){client.disco.addFeature("","jabber:iq:version");client.on("iq:get:version",function(iq){client.sendIq(iq.resultReply({version:client.config.version||{name:"stanza.io"}}))});client.getSoftwareVersion=function(jid,cb){this.sendIq({to:jid,type:"get",version:{}},cb)}}},{"../stanza/version":37}],24:[function(require,module,exports){require("../stanza/visibility");module.exports=function(client){client.goInvisible=function(cb){this.sendIq({type:"set",invisible:true})};client.goVisible=function(cb){this.sendIq({type:"set",visible:true})}}},{"../stanza/visibility":38}],25:[function(require,module,exports){require("../stanza/muc");module.exports=function(client){client.joinRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.caps=this.disco.caps;opts.joinMuc=opts.joinMuc||{};this.sendPresence(opts)};client.leaveRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.type="unavailable";this.sendPresence(opts)}}},{"../stanza/muc":39}],40:[function(require,module,exports){var sha=require("./sha");var rng=require("./rng");var md5=require("./md5");var algorithms={sha1:{hex:sha.hex_sha1,binary:sha.b64_sha1,ascii:sha.str_sha1},md5:{hex:md5.hex_md5,binary:md5.b64_md5,ascii:md5.any_md5}};function error(){var m=[].slice.call(arguments).join(" ");throw new Error([m,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}exports.createHash=function(alg){alg=alg||"sha1";if(!algorithms[alg])error("algorithm:",alg,"is not yet supported");var s="";var _alg=algorithms[alg];return{update:function(data){s+=data;return this},digest:function(enc){enc=enc||"binary";var fn;if(!(fn=_alg[enc]))error("encoding:",enc,"is not yet supported for algorithm",alg);var r=fn(s);s=null;return r}}};exports.randomBytes=function(size,callback){if(callback&&callback.call){try{callback.call(this,undefined,rng(size))}catch(err){callback(err)}}else{return rng(size)}};["createCredentials","createHmac","createCypher","createCypheriv","createDecipher","createDecipheriv","createSign","createVerify","createDeffieHellman","pbkdf2"].forEach(function(name){exports[name]=function(){error("sorry,",name,"is not implemented yet")}})},{"./sha":41,"./rng":42,"./md5":43}],41:[function(require,module,exports){exports.hex_sha1=hex_sha1;exports.b64_sha1=b64_sha1;exports.str_sha1=str_sha1;exports.hex_hmac_sha1=hex_hmac_sha1;exports.b64_hmac_sha1=b64_hmac_sha1;exports.str_hmac_sha1=str_hmac_sha1;var hexcase=0;var b64pad="";var chrsz=8;function hex_sha1(s){return binb2hex(core_sha1(str2binb(s),s.length*chrsz))}function b64_sha1(s){return binb2b64(core_sha1(str2binb(s),s.length*chrsz))}function str_sha1(s){return binb2str(core_sha1(str2binb(s),s.length*chrsz))}function hex_hmac_sha1(key,data){return binb2hex(core_hmac_sha1(key,data))}function b64_hmac_sha1(key,data){return binb2b64(core_hmac_sha1(key,data))}function str_hmac_sha1(key,data){return binb2str(core_hmac_sha1(key,data))}function sha1_vm_test(){return hex_sha1("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function core_hmac_sha1(key,data){var bkey=str2binb(key);if(bkey.length>16)bkey=core_sha1(bkey,key.length*chrsz);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=core_sha1(ipad.concat(str2binb(data)),512+data.length*chrsz);return core_sha1(opad.concat(hash),512+160)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function str2binb(str){var bin=Array();var mask=(1<<chrsz)-1;for(var i=0;i<str.length*chrsz;i+=chrsz)bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<32-chrsz-i%32;return bin}function binb2str(bin){var str="";var mask=(1<<chrsz)-1;for(var i=0;i<bin.length*32;i+=chrsz)str+=String.fromCharCode(bin[i>>5]>>>32-chrsz-i%32&mask);return str}function binb2hex(binarray){var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8+4&15)+hex_tab.charAt(binarray[i>>2]>>(3-i%4)*8&15)}return str}function binb2b64(binarray){var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var str="";for(var i=0;i<binarray.length*4;i+=3){var triplet=(binarray[i>>2]>>8*(3-i%4)&255)<<16|(binarray[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|binarray[i+2>>2]>>8*(3-(i+2)%4)&255;for(var j=0;j<4;j++){if(i*8+j*6>binarray.length*32)str+=b64pad;else str+=tab.charAt(triplet>>6*(3-j)&63)}}return str}},{}],42:[function(require,module,exports){!function(){var _global=this;var mathRNG,whatwgRNG;mathRNG=function(size){var bytes=new Array(size);var r;for(var i=0,r;i<size;i++){if((i&3)==0)r=Math.random()*4294967296;bytes[i]=r>>>((i&3)<<3)&255}return bytes};if(_global.crypto&&crypto.getRandomValues){var _rnds=new Uint32Array(4);whatwgRNG=function(size){var bytes=new Array(size);crypto.getRandomValues(_rnds);for(var c=0;c<size;c++){bytes[c]=_rnds[c>>2]>>>(c&3)*8&255}return bytes}}module.exports=whatwgRNG||mathRNG}()},{}],43:[function(require,module,exports){var hexcase=0;var b64pad="";function hex_md5(s){return rstr2hex(rstr_md5(str2rstr_utf8(s)))}function b64_md5(s){return rstr2b64(rstr_md5(str2rstr_utf8(s)))}function any_md5(s,e){return rstr2any(rstr_md5(str2rstr_utf8(s)),e)}function hex_hmac_md5(k,d){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_md5(k,d){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_md5(k,d,e){return rstr2any(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),s.length*8))}function rstr_hmac_md5(key,data){var bkey=rstr2binl(key);if(bkey.length>16)bkey=binl_md5(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));var remainders=Array(full_length);for(j=0;j<full_length;j++){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[j]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binl(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32;return output}function binl2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function binl_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}exports.hex_md5=hex_md5;exports.b64_md5=b64_md5;exports.any_md5=any_md5},{}],11:[function(require,module,exports){!function(){var WildEmitter=require("wildemitter"),_=require("lodash"),async=require("async"),uuid=require("node-uuid"),stanza=require("./stanza/stanza"),SASL=require("./stanza/sasl"),Message=require("./stanza/message"),Presence=require("./stanza/presence"),Iq=require("./stanza/iq"),WSConnection=require("./websocket");require("./stanza/stream");require("./stanza/sm");require("./stanza/roster");require("./stanza/error");require("./stanza/streamError");require("./stanza/streamFeatures");require("./stanza/bind");require("./stanza/session");function Client(opts){var self=this;WildEmitter.call(this);this.config=opts||{};this._idPrefix=uuid.v4();this._idCount=0;this.negotiatedFeatures={};this.featureOrder=["sasl","streamManagement","bind","streamManagement","session"];this.features={};this.conn=new WSConnection;this.conn.on("*",function(eventName,data){self.emit(eventName,data)});this.on("streamFeatures",function(features){var series=[function(cb){cb(null,features)}],seriesNames=["setup"];self.featureOrder.forEach(function(name){if(features._extensions[name]&&!self.negotiatedFeatures[name]){series.push(function(features,cb){if(!self.negotiatedFeatures[name]){self.features[name](features,cb)}else{cb(null,features)}});seriesNames.push(name)}});async.waterfall(series,function(cmd){if(cmd==="restart"){self.conn.restart()}else if(cmd==="disconnect"){self.disconnect()}})});this.features.sasl=function(features,cb){self.on("sasl:success","sasl",function(){self.negotiatedFeatures.sasl=true;self.releaseGroup("sasl");self.emit("auth:success");cb("restart")});self.on("sasl:failure","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect")});self.on("sasl:abort","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect")});self.send(new SASL.Auth({mechanism:"PLAIN",value:"\0"+self.config.username+"\0"+self.config.password}))};this.features.bind=function(features,cb){self.sendIq({type:"set",bind:{resource:self.config.resource}},function(err,resp){self.negotiatedFeatures.bind=true;self.emit("session:bound",resp.bind.jid);self.jid=resp.bind.jid;if(!features._extensions.session){self.sessionStarted=true;self.emit("session:started",resp.bind.jid)}cb(null,features)})};this.features.session=function(features,cb){self.sendIq({type:"set",session:{}},function(){self.negotiatedFeatures.session=true;self.sessionStarted=true;self.emit("session:started");cb(null,features)})};this.features.streamManagement=function(features,cb){self.on("stream:management:enabled","sm",function(enabled){self.conn.sm.enabled(enabled);self.negotiatedFeatures.streamManagement=true;self.on("stream:management:ack","connection",function(ack){self.conn.sm.process(ack)});self.on("stream:management:request","connection",function(request){self.conn.sm.ack()});self.releaseGroup("sm");cb(null,features)});self.on("stream:management:resumed","sm",function(resumed){self.conn.sm.enabled(resumed);self.negotiatedFeatures.streamManagement=true;self.negotiatedFeatures.bind=true;self.sessionStarted=true;self.on("stream:management:ack","connection",function(ack){self.conn.sm.process(ack)});self.on("stream:management:request","connection",function(request){self.conn.sm.ack()});self.releaseGroup("sm");cb(null,features)});self.on("stream:management:failed","sm",function(failed){self.conn.sm.failed();self.emit("session:end");self.releaseGroup("session");self.releaseGroup("sm");cb(null,features)});if(!self.conn.sm.id){if(self.negotiatedFeatures.bind){self.conn.sm.enable()}else{cb(null,features)}}else if(self.conn.sm.id&&self.conn.sm.allowResume){self.conn.sm.resume()}else{cb(null,features)}};this.on("disconnected",function(){self.sessionStarted=false;self.negotiatedFeatures.sasl=false;self.negotiatedFeatures.streamManagement=false;self.negotiatedFeatures.bind=false;self.releaseGroup("connection")});this.on("iq:set:roster",function(iq){self.emit("roster:update",iq);self.sendIq({id:iq.id,type:"result"})});this.on("iq",function(iq){var iqType=iq.type,exts=Object.keys(iq._extensions),children=iq.xml.childNodes;if(iq.type==="get"||iq.type==="set"){if(children.length!=1){return self.sendIq({id:iq.id,type:"error",error:{type:"modify",condition:"bad-request"}})}if(!exts.length){return self.sendIq({id:iq.id,type:"error",error:{type:"cancel",condition:"feature-not-implemented"}})}var iqEvent="iq:"+iqType+":"+exts[0];if(self.callbacks[iqEvent]){self.emit(iqEvent,iq)}else{self.sendIq({id:iq.id,type:"error",error:{type:"cancel",condition:"feature-not-implemented"}})}}});this.on("message",function(msg){if(Object.keys(msg.$body).length){if(msg.type==="chat"||msg.type==="normal"){self.emit("chat",msg)}else if(msg.type==="groupchat"){self.emit("groupchat",msg)}}});this.on("presence",function(pres){var presType=pres.type||"available";self.emit(presType,pres)})}Client.prototype=Object.create(WildEmitter.prototype,{constructor:{value:Client}});Client.prototype.__defineGetter__("stream",function(){return this.conn?this.conn.stream:undefined});Client.prototype.use=function(pluginInit){pluginInit(this)};Client.prototype.nextId=function(){return this._idPrefix+"-"+(this._idCount++).toString(16)};Client.prototype.connect=function(){this.conn.connect(this.config)};Client.prototype.disconnect=function(){if(this.sessionStarted){this.emit("session:end");this.releaseGroup("session")}this.sessionStarted=false;this.releaseGroup("connection");if(this.conn){this.conn.disconnect()}};Client.prototype.send=function(data){this.conn.send(data)};Client.prototype.sendMessage=function(data){data=data||{};if(!data.id){data.id=this.nextId()}this.send(new Message(data))};Client.prototype.sendPresence=function(data){data=data||{};if(!data.id){data.id=this.nextId()}this.send(new Presence(data))};Client.prototype.sendIq=function(data,cb){data=data||{};cb=cb||function(){};if(!data.id){data.id=this.nextId()}if(data.type==="get"||data.type==="set"){this.once("id:"+data.id,"session",function(resp){if(resp._extensions.error){cb(resp,null)}else{cb(null,resp)}})}this.send(new Iq(data))};Client.prototype.getRoster=function(cb){var self=this;cb=cb||function(){};this.sendIq({type:"get",roster:{ver:self.config.rosterVer}},function(err,resp){if(err){return cb(err)}if(resp.type==="result"){if(resp.roster.ver){self.config.rosterVer=resp.roster.ver;self.emit("roster:ver",resp.roster.ver)}}cb(null,resp)})};Client.prototype.updateRosterItem=function(item,cb){this.sendIq({type:"set",roster:{items:[item]}},cb)};Client.prototype.removeRosterItem=function(jid,cb){this.updateRosterItem({jid:jid,subscription:"remove"},cb)};Client.prototype.subscribe=function(jid){this.sendPresence({type:"subscribe",to:jid})};Client.prototype.unsubscribe=function(jid){this.sendPresence({type:"unsubscribe",to:jid})};Client.prototype.acceptSubscription=function(jid){this.sendPresence({type:"subscribed",to:jid})};Client.prototype.denySubscription=function(jid){this.sendPresence({type:"unsubscribed",to:jid})};module.exports=Client}()},{"./stanza/stanza":2,"./stanza/sasl":44,"./stanza/message":4,"./stanza/presence":5,"./stanza/iq":6,"./websocket":45,"./stanza/stream":3,"./stanza/sm":46,"./stanza/roster":47,"./stanza/error":48,"./stanza/streamError":49,"./stanza/streamFeatures":50,"./stanza/bind":51,"./stanza/session":52,wildemitter:53,lodash:54,"node-uuid":55,async:56}],46:[function(require,module,exports){var stanza=require("./stanza"),StreamFeatures=require("./streamFeatures");function SMFeature(data,xml){return stanza.init(this,xml,data)}SMFeature.prototype={constructor:{value:SMFeature},_name:"streamManagement",NS:"urn:xmpp:sm:3",EL:"sm",toString:stanza.toString,toJSON:stanza.toJSON};function Enable(data,xml){return stanza.init(this,xml,data)}Enable.prototype={constructor:{value:Enable},_name:"smEnable",_eventname:"stream:management:enable",NS:"urn:xmpp:sm:3",EL:"enable",toString:stanza.toString,toJSON:stanza.toJSON,get resume(){var val=this.xml.getAttribute("resume");return val=="true"||val=="1"},set resume(val){if(val){this.xml.setAttribute("resume","true")}}};function Enabled(data,xml){return stanza.init(this,xml,data)}Enabled.prototype={constructor:{value:Enabled},_name:"smEnabled",_eventname:"stream:management:enabled",NS:"urn:xmpp:sm:3",EL:"enabled",toString:stanza.toString,toJSON:stanza.toJSON,get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)},get resume(){var val=this.xml.getAttribute("resume");return val=="true"||val=="1"},set resume(val){if(val){this.xml.setAttribute("resume","true")}}};function Resume(data,xml){return stanza.init(this,xml,data)}Resume.prototype={constructor:{value:Resume},_name:"smResume",_eventname:"stream:management:resume",NS:"urn:xmpp:sm:3",EL:"resume",toString:stanza.toString,toJSON:stanza.toJSON,get h(){return parseInt(this.xml.getAttribute("h")||"0",10)},set h(value){this.xml.setAttribute("h",""+value)},get previd(){return this.xml.getAttribute("previd")||""},set previd(value){this.xml.setAttribute("previd",value)}};function Resumed(data,xml){return stanza.init(this,xml,data)}Resumed.prototype={constructor:{value:Resumed},_name:"smResumed",_eventname:"stream:management:resumed",NS:"urn:xmpp:sm:3",EL:"resumed",toString:stanza.toString,toJSON:stanza.toJSON,get h(){return parseInt(this.xml.getAttribute("h")||"0",10)},set h(value){this.xml.setAttribute("h",""+value)},get previd(){return this.xml.getAttribute("previd")||""},set previd(value){this.xml.setAttribute("previd",value)}};function Failed(data,xml){return stanza.init(this,xml,data)}Failed.prototype={constructor:{value:Failed},_name:"smFailed",_eventname:"stream:management:failed",NS:"urn:xmpp:sm:3",EL:"failed",toString:stanza.toString,toJSON:stanza.toJSON};function Ack(data,xml){return stanza.init(this,xml,data)}Ack.prototype={constructor:{value:Ack},_name:"smAck",_eventname:"stream:management:ack",NS:"urn:xmpp:sm:3",EL:"a",toString:stanza.toString,toJSON:stanza.toJSON,get h(){return parseInt(this.xml.getAttribute("h")||"0",10)},set h(value){this.xml.setAttribute("h",""+value)}};function Request(data,xml){return stanza.init(this,xml,data)}Request.prototype={constructor:{value:Request},_name:"smRequest",_eventname:"stream:management:request",NS:"urn:xmpp:sm:3",EL:"r",toString:stanza.toString,toJSON:stanza.toJSON};stanza.extend(StreamFeatures,SMFeature);stanza.topLevel(Ack);stanza.topLevel(Request);stanza.topLevel(Enable);stanza.topLevel(Enabled);stanza.topLevel(Resume);stanza.topLevel(Resumed);stanza.topLevel(Failed);exports.SMFeature=SMFeature;exports.Enable=Enable;exports.Enabled=Enabled;exports.Resume=Resume;exports.Resumed=Resumed;exports.Failed=Failed;exports.Ack=Ack;exports.Request=Request},{"./stanza":2,"./streamFeatures":50}],50:[function(require,module,exports){var stanza=require("./stanza");function StreamFeatures(data,xml){return stanza.init(this,xml,data)}StreamFeatures.prototype={constructor:{value:StreamFeatures},_name:"streamFeatures",NS:"http://etherx.jabber.org/streams",EL:"features",_FEATURES:[],toString:stanza.toString,toJSON:stanza.toJSON,get features(){return this._extensions
}};stanza.topLevel(StreamFeatures);module.exports=StreamFeatures},{"./stanza":2}],51:[function(require,module,exports){var stanza=require("./stanza"),Iq=require("./iq"),StreamFeatures=require("./streamFeatures");function Bind(data,xml){return stanza.init(this,xml,data)}Bind.prototype={constructor:{value:Bind},_name:"bind",NS:"urn:ietf:params:xml:ns:xmpp-bind",EL:"bind",toString:stanza.toString,toJSON:stanza.toJSON,get resource(){return stanza.getSubText(this.xml,this.NS,"resource")},set resource(value){stanza.setSubText(this.xml,this.NS,"resource")},get jid(){return stanza.getSubText(this.xml,this.NS,"jid")},set jid(value){stanza.setSubText(this.xml,this.NS,"jid")}};stanza.extend(Iq,Bind);stanza.extend(StreamFeatures,Bind);module.exports=Bind},{"./stanza":2,"./iq":6,"./streamFeatures":50}],52:[function(require,module,exports){var stanza=require("./stanza"),Iq=require("./iq"),StreamFeatures=require("./streamFeatures");function Session(data,xml){return stanza.init(this,xml,data)}Session.prototype={constructor:{value:Session},_name:"session",NS:"urn:ietf:params:xml:ns:xmpp-session",EL:"session",toString:stanza.toString,toJSON:stanza.toJSON};stanza.extend(StreamFeatures,Session);stanza.extend(Iq,Session);module.exports=Session},{"./stanza":2,"./iq":6,"./streamFeatures":50}],57:[function(require,module,exports){var stanza=require("./stanza"),Presence=require("./presence"),StreamFeatures=require("./streamFeatures");function Caps(data,xml){return stanza.init(this,xml,data)}Caps.prototype={constructor:{value:Caps},NS:"http://jabber.org/protocol/caps",EL:"c",_name:"caps",toString:stanza.toString,toJSON:stanza.toJSON,get ver(){return this.xml.getAttribute("ver")||""},set ver(value){this.xml.setAttribute("ver",value)},get node(){return this.xml.getAttribute("node")||""},set node(value){this.xml.setAttribute("node",value)},get hash(){return this.xml.getAttribute("hash")||""},set hash(value){this.xml.setAttribute("hash",value)},get ext(){return this.xml.getAttribute("ext")||""},set ext(value){this.xml.setAttribute("ext",value)}};stanza.extend(Presence,Caps);stanza.extend(StreamFeatures,Caps);module.exports=Caps},{"./stanza":2,"./presence":5,"./streamFeatures":50}],27:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message");function ChatStateActive(data,xml){return stanza.init(this,xml,data)}ChatStateActive.prototype={constructor:{value:ChatStateActive},NS:"http://jabber.org/protocol/chatstates",EL:"active",_name:"chatStateActive",_eventname:"chat:active",toString:stanza.toString,toJSON:undefined};function ChatStateComposing(data,xml){return stanza.init(this,xml,data)}ChatStateComposing.prototype={constructor:{value:ChatStateComposing},NS:"http://jabber.org/protocol/chatstates",EL:"composing",_name:"chatStateComposing",_eventname:"chat:composing",toString:stanza.toString,toJSON:undefined};function ChatStatePaused(data,xml){return stanza.init(this,xml,data)}ChatStatePaused.prototype={constructor:{value:ChatStatePaused},NS:"http://jabber.org/protocol/chatstates",EL:"paused",_name:"chatStatePaused",_eventname:"chat:paused",toString:stanza.toString,toJSON:undefined};function ChatStateInactive(data,xml){return stanza.init(this,xml,data)}ChatStateInactive.prototype={constructor:{value:ChatStateInactive},NS:"http://jabber.org/protocol/chatstates",EL:"inactive",_name:"chatStateInactive",_eventname:"chat:inactive",toString:stanza.toString,toJSON:undefined};function ChatStateGone(data,xml){return stanza.init(this,xml,data)}ChatStateGone.prototype={constructor:{value:ChatStateGone},NS:"http://jabber.org/protocol/chatstates",EL:"gone",_name:"chatStateGone",_eventname:"chat:gone",toString:stanza.toString,toJSON:undefined};stanza.extend(Message,ChatStateActive);stanza.extend(Message,ChatStateComposing);stanza.extend(Message,ChatStatePaused);stanza.extend(Message,ChatStateInactive);stanza.extend(Message,ChatStateGone);Message.prototype.__defineGetter__("chatState",function(){var self=this,states=["Active","Composing","Paused","Inactive","Gone"];for(var i=0;i<states.length;i++){if(self._extensions["chatState"+states[i]]){return states[i].toLowerCase()}}return""});Message.prototype.__defineSetter__("chatState",function(value){var self=this,states=["Active","Composing","Paused","Inactive","Gone"];states.forEach(function(state){if(self._extensions["chatState"+state]){self.xml.removeChild(self._extensions["chatState"+state].xml);delete self._extensions["chatState"+state]}});if(value){this["chatState"+value.charAt(0).toUpperCase()+value.slice(1)]}})},{"./stanza":2,"./message":4}],28:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message"),Presence=require("./presence");function DelayedDelivery(data,xml){return stanza.init(this,xml,data)}DelayedDelivery.prototype={constructor:{value:DelayedDelivery},NS:"urn:xmpp:delay",EL:"delay",_name:"delay",toString:stanza.toString,toJSON:stanza.toJSON,get from(){return this.xml.getAttribute("from")||""},set from(value){this.xml.setAttribute("from",value)},get stamp(){return new Date(this.xml.getAttribute("stamp")||"")},set stamp(value){this.xml.setAttribute("stamp",value.toISOString())},get reason(){return this.xml.textContent||""},set reason(value){this.xml.textContent=value}};stanza.extend(Message,DelayedDelivery);stanza.extend(Presence,DelayedDelivery);module.exports=DelayedDelivery},{"./stanza":2,"./message":4,"./presence":5}],29:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message"),Presence=require("./presence"),Iq=require("./iq"),DelayedDelivery=require("./delayed");function Forwarded(data,xml){return stanza.init(this,xml,data)}Forwarded.prototype={constructor:{value:Forwarded},NS:"urn:xmpp:forward:0",EL:"forwarded",_name:"forwarded",_eventname:"forward",toString:stanza.toString,toJSON:stanza.toJSON};stanza.extend(Message,Forwarded);stanza.extend(Forwarded,Message);stanza.extend(Forwarded,Presence);stanza.extend(Forwarded,Iq);stanza.extend(Forwarded,DelayedDelivery);module.exports=Forwarded},{"./stanza":2,"./message":4,"./presence":5,"./iq":6,"./delayed":28}],30:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message"),Iq=require("./iq"),Forwarded=require("./forwarded");function Sent(data,xml){return stanza.init(this,xml,data)}Sent.prototype={constructor:{value:Sent},NS:"urn:xmpp:carbons:2",EL:"sent",_name:"carbonSent",_eventname:"carbon:sent",toString:stanza.toString,toJSON:stanza.toJSON};function Received(data,xml){return stanza.init(this,xml,data)}Received.prototype={constructor:{value:Received},NS:"urn:xmpp:carbons:2",EL:"received",_name:"carbonReceived",_eventname:"carbon:received",toString:stanza.toString,toJSON:stanza.toJSON};function Private(data,xml){return stanza.init(this,xml,data)}Private.prototype={constructor:{value:Private},NS:"urn:xmpp:carbons:2",EL:"private",_name:"carbonPrivate",_eventname:"carbon:private",toString:stanza.toString,toJSON:stanza.toJSON};function Enable(data,xml){return stanza.init(this,xml,data)}Enable.prototype={constructor:{value:Enable},NS:"urn:xmpp:carbons:2",EL:"enable",_name:"enableCarbons",toString:stanza.toString,toJSON:stanza.toJSON};function Disable(data,xml){return stanza.init(this,xml,data)}Disable.prototype={constructor:{value:Disable},NS:"urn:xmpp:carbons:2",EL:"disable",_name:"disableCarbons",toString:stanza.toString,toJSON:stanza.toJSON};stanza.extend(Sent,Forwarded);stanza.extend(Received,Forwarded);stanza.extend(Message,Sent);stanza.extend(Message,Received);stanza.extend(Message,Private);stanza.extend(Iq,Enable);stanza.extend(Iq,Disable);exports.Sent=Sent;exports.Received=Received;exports.Private=Private;exports.Enable=Enable;exports.Disable=Disable},{"./stanza":2,"./message":4,"./iq":6,"./forwarded":29}],31:[function(require,module,exports){var stanza=require("./stanza"),Iq=require("./iq");function EntityTime(data,xml){return stanza.init(this,xml,data)}EntityTime.prototype={constructor:{value:EntityTime},NS:"urn:xmpp:time",EL:"time",_name:"time",toString:stanza.toString,toJSON:stanza.toJSON,get tzo(){var sign=-1,formatted=stanza.getSubText(this.xml,this.NS,"tzo");if(!formatted){return 0}if(formatted.charAt(0)==="-"){sign=1;formatted.slice(1)}var split=formatted.split(":"),hrs=parseInt(split[0],10),min=parseInt(split[1],10);return(hrs*60+min)*sign},set tzo(value){var formatted="-";if(typeof value==="number"){if(value<0){value=-value;formatted="+"}var hrs=value/60,min=value%60;formatted+=(hrs<10?"0":"")+hrs+":"+(min<10?"0":"")+min}else{formatted=value}stanza.setSubText(this.xml,this.NS,"tzo",formatted)},get utc(){var stamp=stanza.getSubText(this.xml,this.NS,"utc");if(stamp){return new Date(stamp)}return""},set utc(value){stanza.setSubText(this.xml,this.NS,"utc",value.toISOString())}};stanza.extend(Iq,EntityTime);module.exports=EntityTime},{"./stanza":2,"./iq":6}],32:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message"),Iq=require("./iq"),Forwarded=require("./forwarded"),RSM=require("./rsm");function MAMQuery(data,xml){return stanza.init(this,xml,data)}MAMQuery.prototype={constructor:{value:MAMQuery},NS:"urn:xmpp:mam:tmp",EL:"query",_name:"mamQuery",toString:stanza.toString,toJSON:stanza.toJSON,get queryid(){return this.xml.getAttribute("queryid")||""},set queryid(value){this.xml.setAttribute("queryid",value)},get start(){return new Date(stanza.getSubText(this.xml,this.NS,"start")||"")},set start(value){stanza.setSubText(this.xml,this.NS,"start",value.toISOString())},get end(){return new Date(stanza.getSubText(this.xml,this.NS,"end")||"")},set end(value){stanza.setSubText(this.xml,this.NS,"end",value.toISOString())}};MAMQuery.prototype.__defineGetter__("with",function(){return stanza.getSubText(this.xml,this.NS,"with")});MAMQuery.prototype.__defineSetter__("with",function(value){stanza.setSubText(this.xml,this.NS,"with",value)});function Result(data,xml){return stanza.init(this,xml,data)}Result.prototype={constructor:{value:Result},NS:"urn:xmpp:mam:tmp",EL:"result",_name:"mam",_eventname:"mam:result",toString:stanza.toString,toJSON:stanza.toJSON,get queryid(){return this.xml.getAttribute("queryid")||""},set queryid(value){this.xml.setAttribute("queryid",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)}};function Archived(data,xml){return stanza.init(this,xml,data)}Archived.prototype={constructor:{value:Result},NS:"urn:xmpp:mam:tmp",EL:"archived",_name:"archived",_eventname:"mam:archived",toString:stanza.toString,toJSON:stanza.toJSON,get by(){return this.xml.getAttribute("queryid")||""},set by(value){this.xml.setAttribute("queryid",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)}};stanza.extend(Iq,MAMQuery);stanza.extend(Message,Result);stanza.extend(Message,Archived);stanza.extend(Result,Forwarded);stanza.extend(MAMQuery,RSM);exports.MAMQuery=MAMQuery;exports.Result=Result},{"./stanza":2,"./message":4,"./iq":6,"./forwarded":29,"./rsm":58}],33:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message");function Request(data,xml){return stanza.init(this,xml,data)}Request.prototype={constructor:{value:Request},NS:"urn:xmpp:receipts",EL:"request",_name:"_requestReceipt",toString:stanza.toString,toJSON:undefined};function Received(data,xml){return stanza.init(this,xml,data)}Received.prototype={constructor:{value:Received},NS:"urn:xmpp:receipts",EL:"received",_name:"receipt",toString:stanza.toString,toJSON:stanza.toJSON,get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)}};Message.prototype.__defineGetter__("requestReceipt",function(){return!!this._extensions._requestReceipt});Message.prototype.__defineSetter__("requestReceipt",function(value){if(value){this._requestReceipt=true}else if(this._extensions._requestReceipt){this.xml.removeChild(this._extensions._requestReceipt.xml);delete this._extensions._requestReceipt}});stanza.extend(Message,Received);stanza.extend(Message,Request);exports.Request=Request;exports.Received=Received},{"./stanza":2,"./message":4}],34:[function(require,module,exports){var stanza=require("./stanza"),Presence=require("./presence");function Idle(data,xml){return stanza.init(this,xml,data)}Idle.prototype={constructor:{value:Idle},NS:"urn:xmpp:idle:0",EL:"idle",_name:"idle",toString:stanza.toString,toJSON:stanza.toJSON,get since(){return new Date(this.xml.getAttribute("since")||"")},set since(value){this.xml.setAttribute("since",value.toISOString())}};stanza.extend(Presence,Idle);module.exports=Idle},{"./stanza":2,"./presence":5}],35:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message");function Replace(data,xml){return stanza.init(this,xml,data)}Replace.prototype={constructor:{value:Replace},NS:"urn:xmpp:message-correct:0",EL:"replace",_name:"_replace",toString:stanza.toString,toJSON:undefined,get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)}};stanza.extend(Message,Replace);Message.prototype.__defineGetter__("replace",function(){if(this._extensions._replace){return this._replace.id}return""});Message.prototype.__defineSetter__("replace",function(value){if(value){this._replace.id=value}else if(this._extensions._replace){this.xml.removeChild(this._extensions._replace.xml);delete this._extensions._replace}});module.exports=Replace},{"./stanza":2,"./message":4}],36:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message");function Attention(data,xml){return stanza.init(this,xml,data)}Attention.prototype={constructor:{value:Attention},NS:"urn:xmpp:attention:0",EL:"attention",_name:"_attention",toString:stanza.toString,toJSON:undefined};Message.prototype.__defineGetter__("attention",function(){return!!this._extensions._attention});Message.prototype.__defineSetter__("attention",function(value){if(value){this._attention=true}else if(this._extensions._attention){this.xml.removeChild(this._extensions._attention.xml);delete this._extensions._attention}});stanza.extend(Message,Attention);module.exports=Attention},{"./stanza":2,"./message":4}],37:[function(require,module,exports){var stanza=require("./stanza"),Iq=require("./iq");function Version(data,xml){return stanza.init(this,xml,data)}Version.prototype={constructor:{value:Version},NS:"jabber:iq:version",EL:"query",_name:"version",toString:stanza.toString,toJSON:stanza.toJSON,get name(){return stanza.getSubText(this.xml,this.NS,"name")},set name(value){stanza.setSubText(this.xml,this.NS,"name",value)},get version(){return stanza.getSubText(this.xml,this.NS,"version")},set version(value){stanza.setSubText(this.xml,this.NS,"version",value)},get os(){return stanza.getSubText(this.xml,this.NS,"os")},set os(value){stanza.setSubText(this.xml,this.NS,"os",value)}};stanza.extend(Iq,Version);module.exports=Version},{"./stanza":2,"./iq":6}],38:[function(require,module,exports){var stanza=require("./stanza"),Iq=require("./iq");function Visible(data,xml){return stanza.init(this,xml,data)}Visible.prototype={constructor:{value:Visible},NS:"urn:xmpp:invisible:0",EL:"visible",_name:"_visible",toString:stanza.toString,toJSON:undefined};function Invisible(data,xml){return stanza.init(this,xml,data)}Invisible.prototype={constructor:{value:Invisible},NS:"urn:xmpp:invisible:0",EL:"invisible",_name:"_invisible",toString:stanza.toString,toJSON:undefined};Iq.prototype.__defineGetter__("visible",function(){return!!this._extensions._visible});Iq.prototype.__defineSetter__("visible",function(value){if(value){this._visible=true}else if(this._extensions._visible){this.xml.removeChild(this._extensions._visible.xml);delete this._extensions._visible}});Iq.prototype.__defineGetter__("invisible",function(){return!!this._extensions._invisible});Iq.prototype.__defineSetter__("invisible",function(value){if(value){this._invisible=true}else if(this._extensions._invisible){this.xml.removeChild(this._extensions._invisible.xml);delete this._extensions._invisible}});stanza.extend(Iq,Visible);stanza.extend(Iq,Invisible);exports.Visible=Visible;exports.Invisible=Invisible},{"./stanza":2,"./iq":6}],39:[function(require,module,exports){var stanza=require("./stanza"),Message=require("./message"),Presence=require("./presence"),Iq=require("./iq");function MUCJoin(data,xml){return stanza.init(this,xml,data)}MUCJoin.prototype={constructor:{value:MUCJoin},NS:"http://jabber.org/protocol/muc",EL:"x",_name:"joinMuc",toString:stanza.toString,toJSON:stanza.toJSON,get password(){return stanza.getSubText(this.xml,this.NS,"password")},set password(value){stanza.setSubText(this.xml,this.NS,"password",value)},get history(){var hist=stanza.find(this.xml,this.NS,"history");if(!hist.length){return{}}hist=hist[0];var maxchars=hist.getAttribute("maxchars")||"",maxstanzas=hist.getAttribute("maxstanas")||"",seconds=hist.getAttribute("seconds")||"",since=hist.getAttribute("since")||"";var result={};if(maxchars){result.maxchars=parseInt(maxchars,10)}if(maxstanzas){result.maxstanzas=parseInt(maxstanzas,10)}if(seconds){result.seconds=parseInt(seconds,10)}if(since){result.since=new Date(since)}},set history(opts){var existing=stanza.find(this.xml,this.NS,"history");if(existing.length){for(var i=0;i<existing.length;i++){this.xml.removeChild(existing[i])}}var hist=document.createElementNS(this.NS,"history");this.xml.appendChild(hist);if(opts.maxchars){hist.setAttribute(""+opts.maxchars)}if(opts.maxstanzas){hist.setAttribute(""+opts.maxstanzas)}if(opts.seconds){hist.setAttribute(""+opts.seconds)}if(opts.since){hist.setAttribute(opts.since.toISOString())}}};stanza.extend(Presence,MUCJoin);exports.MUCJoin=MUCJoin},{"./stanza":2,"./message":4,"./presence":5,"./iq":6}],53:[function(require,module,exports){module.exports=WildEmitter;function WildEmitter(){this.callbacks={}}WildEmitter.prototype.on=function(event,groupName,fn){var hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];func._groupName=group;(this.callbacks[event]=this.callbacks[event]||[]).push(func);return this};WildEmitter.prototype.once=function(event,groupName,fn){var self=this,hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on);func.apply(this,arguments)}this.on(event,group,on);return this};WildEmitter.prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks){handlers=this.callbacks[item];for(i=0,len=handlers.length;i<len;i++){if(handlers[i]._groupName===groupName){handlers.splice(i,1);i--;len--}}}return this};WildEmitter.prototype.off=function(event,fn){var callbacks=this.callbacks[event],i;if(!callbacks)return this;if(arguments.length===1){delete this.callbacks[event];return this}i=callbacks.indexOf(fn);callbacks.splice(i,1);return this};WildEmitter.prototype.emit=function(event){var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item;if(callbacks){for(i=0,len=callbacks.length;i<len;++i){if(callbacks[i]){callbacks[i].apply(this,args)}else{break}}}if(specialCallbacks){for(i=0,len=specialCallbacks.length;i<len;++i){if(specialCallbacks[i]){specialCallbacks[i].apply(this,[event].concat(args))}else{break}}}return this};WildEmitter.prototype.getWildcardCallbacks=function(eventName){var item,split,result=[];for(item in this.callbacks){split=item.split("*");if(item==="*"||split.length===2&&eventName.slice(0,split[1].length)===split[1]){result=result.concat(this.callbacks[item])}}return result}},{}],59:[function(require,module,exports){require=function(e,t,n,r){function i(r){if(!n[r]){if(!t[r]){if(e)return e(r);throw new Error("Cannot find module '"+r+"'")}var s=n[r]={exports:{}};t[r][0](function(e){var n=t[r][1][e];return i(n?n:e)},s,s.exports)}return n[r].exports}for(var s=0;s<r.length;s++)i(r[s]);return i}(typeof require!=="undefined"&&require,{1:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],2:[function(require,module,exports){!function(){var util=require("util");var Buffer=require("buffer").Buffer;var pSlice=Array.prototype.slice;function objectKeys(object){if(Object.keys)return Object.keys(object);var result=[];for(var name in object){if(Object.prototype.hasOwnProperty.call(object,name)){result.push(name)}}return result}var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.message=options.message;this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(value===undefined){return""+value}if(typeof value==="number"&&(isNaN(value)||!isFinite(value))){return value.toString()}if(typeof value==="function"||value instanceof RegExp){return value.toString()}return value}function truncate(s,n){if(typeof s=="string"){return s.length<n?s:s.slice(0,n)}else{return s}}assert.AssertionError.prototype.toString=function(){if(this.message){return[this.name+":",this.message].join(" ")}else{return[this.name+":",truncate(JSON.stringify(this.actual,replacer),128),this.operator,truncate(JSON.stringify(this.expected,replacer),128)].join(" ")}};assert.AssertionError.__proto__=Error.prototype;function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!!!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(Buffer.isBuffer(actual)&&Buffer.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return actual==expected}else{return objEquiv(actual,expected)}}function isUndefinedOrNull(value){return value===null||value===undefined}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}try{var ka=objectKeys(a),kb=objectKeys(b),key,i}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(expected instanceof RegExp){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(typeof expected==="string"){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail("Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail("Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,error,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}}}()},{util:3,buffer:4}],"buffer-browserify":[function(require,module,exports){module.exports=require("q9TxCC")},{}],q9TxCC:[function(require,module,exports){!function(){function SlowBuffer(size){this.length=size}var assert=require("assert");exports.INSPECT_MAX_BYTES=50;function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}SlowBuffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":case"binary":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}SlowBuffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};SlowBuffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};SlowBuffer.prototype.binaryWrite=SlowBuffer.prototype.asciiWrite;SlowBuffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}SlowBuffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};SlowBuffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};SlowBuffer.prototype.binarySlice=SlowBuffer.prototype.asciiSlice;SlowBuffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<SlowBuffer "+out.join(" ")+">"};SlowBuffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}SlowBuffer._charsWritten=i*2;return i};SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};SlowBuffer.prototype.copy=function(target,targetstart,sourcestart,sourceend){var temp=[];for(var i=sourcestart;i<sourceend;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=targetstart;i<targetstart+temp.length;i++){target[i]=temp[i-targetstart]}};SlowBuffer.prototype.fill=function(value,start,end){if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}for(var i=start;i<end;i++){this[i]=value}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}var type;if(typeof offset==="number"){this.length=coerce(encoding);this.parent=subject;this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);
break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(this.length>Buffer.poolSize){this.parent=new SlowBuffer(this.length);this.offset=0}else{if(!pool||pool.length-pool.used<this.length)allocPool();this.parent=pool;this.offset=pool.used;pool.used+=this.length}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){if(subject instanceof Buffer){this.parent[i+this.offset]=subject.readUInt8(i)}else{this.parent[i+this.offset]=subject[i]}}}else if(type=="string"){this.length=this.write(subject,0,encoding)}}}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}exports.SlowBuffer=SlowBuffer;exports.Buffer=Buffer;Buffer.poolSize=8*1024;var pool;function allocPool(){pool=new SlowBuffer(Buffer.poolSize);pool.used=0}Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof SlowBuffer};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.prototype.inspect=function inspect(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this.parent[i+this.offset]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]=v};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=this.parent.hexWrite(string,this.offset+offset,length);break;case"utf8":case"utf-8":ret=this.parent.utf8Write(string,this.offset+offset,length);break;case"ascii":ret=this.parent.asciiWrite(string,this.offset+offset,length);break;case"binary":ret=this.parent.binaryWrite(string,this.offset+offset,length);break;case"base64":ret=this.parent.base64Write(string,this.offset+offset,length);break;case"ucs2":case"ucs-2":ret=this.parent.ucs2Write(string,this.offset+offset,length);break;default:throw new Error("Unknown encoding")}Buffer._charsWritten=SlowBuffer._charsWritten;return ret};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(typeof start=="undefined"||start<0){start=0}else if(start>this.length){start=this.length}if(typeof end=="undefined"||end>this.length){end=this.length}else if(end<0){end=0}start=start+this.offset;end=end+this.offset;switch(encoding){case"hex":return this.parent.hexSlice(start,end);case"utf8":case"utf-8":return this.parent.utf8Slice(start,end);case"ascii":return this.parent.asciiSlice(start,end);case"binary":return this.parent.binarySlice(start,end);case"base64":return this.parent.base64Slice(start,end);case"ucs2":case"ucs-2":return this.parent.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.byteLength=SlowBuffer.byteLength;Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}return this.parent.fill(value,start+this.offset,end+this.offset)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);end||(end=this.length);target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}return this.parent.copy(target.parent,target_start+target.offset,start+this.offset,end+this.offset)};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length)throw new Error("oob");if(start>end)throw new Error("oob");return new Buffer(this.parent,end-start,+start+this.offset)};Buffer.prototype.utf8Slice=function(start,end){return this.toString("utf8",start,end)};Buffer.prototype.binarySlice=function(start,end){return this.toString("binary",start,end)};Buffer.prototype.asciiSlice=function(start,end){return this.toString("ascii",start,end)};Buffer.prototype.utf8Write=function(string,offset){return this.write(string,offset,"utf8")};Buffer.prototype.binaryWrite=function(string,offset){return this.write(string,offset,"binary")};Buffer.prototype.asciiWrite=function(string,offset){return this.write(string,offset,"ascii")};Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;return buffer.parent[buffer.offset+offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){val=buffer.parent[buffer.offset+offset]<<8;if(offset+1<buffer.length){val|=buffer.parent[buffer.offset+offset+1]}}else{val=buffer.parent[buffer.offset+offset];if(offset+1<buffer.length){val|=buffer.parent[buffer.offset+offset+1]<<8}}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return 0;if(isBigEndian){if(offset+1<buffer.length)val=buffer.parent[buffer.offset+offset+1]<<16;if(offset+2<buffer.length)val|=buffer.parent[buffer.offset+offset+2]<<8;if(offset+3<buffer.length)val|=buffer.parent[buffer.offset+offset+3];val=val+(buffer.parent[buffer.offset+offset]<<24>>>0)}else{if(offset+2<buffer.length)val=buffer.parent[buffer.offset+offset+2]<<16;if(offset+1<buffer.length)val|=buffer.parent[buffer.offset+offset+1]<<8;val|=buffer.parent[buffer.offset+offset];if(offset+3<buffer.length)val=val+(buffer.parent[buffer.offset+offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}if(offset>=buffer.length)return;neg=buffer.parent[buffer.offset+offset]&128;if(!neg){return buffer.parent[buffer.offset+offset]}return(255-buffer.parent[buffer.offset+offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}if(offset<buffer.length){buffer.parent[buffer.offset+offset]=value}};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}for(var i=0;i<Math.min(buffer.length-offset,2);i++){buffer.parent[buffer.offset+offset+i]=(value&255<<8*(isBigEndian?1-i:i))>>>(isBigEndian?1-i:i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}for(var i=0;i<Math.min(buffer.length-offset,4);i++){buffer.parent[buffer.offset+offset+i]=value>>>(isBigEndian?3-i:i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)};SlowBuffer.prototype.readUInt8=Buffer.prototype.readUInt8;SlowBuffer.prototype.readUInt16LE=Buffer.prototype.readUInt16LE;SlowBuffer.prototype.readUInt16BE=Buffer.prototype.readUInt16BE;SlowBuffer.prototype.readUInt32LE=Buffer.prototype.readUInt32LE;SlowBuffer.prototype.readUInt32BE=Buffer.prototype.readUInt32BE;SlowBuffer.prototype.readInt8=Buffer.prototype.readInt8;SlowBuffer.prototype.readInt16LE=Buffer.prototype.readInt16LE;SlowBuffer.prototype.readInt16BE=Buffer.prototype.readInt16BE;SlowBuffer.prototype.readInt32LE=Buffer.prototype.readInt32LE;SlowBuffer.prototype.readInt32BE=Buffer.prototype.readInt32BE;SlowBuffer.prototype.readFloatLE=Buffer.prototype.readFloatLE;SlowBuffer.prototype.readFloatBE=Buffer.prototype.readFloatBE;SlowBuffer.prototype.readDoubleLE=Buffer.prototype.readDoubleLE;SlowBuffer.prototype.readDoubleBE=Buffer.prototype.readDoubleBE;SlowBuffer.prototype.writeUInt8=Buffer.prototype.writeUInt8;SlowBuffer.prototype.writeUInt16LE=Buffer.prototype.writeUInt16LE;SlowBuffer.prototype.writeUInt16BE=Buffer.prototype.writeUInt16BE;SlowBuffer.prototype.writeUInt32LE=Buffer.prototype.writeUInt32LE;SlowBuffer.prototype.writeUInt32BE=Buffer.prototype.writeUInt32BE;SlowBuffer.prototype.writeInt8=Buffer.prototype.writeInt8;SlowBuffer.prototype.writeInt16LE=Buffer.prototype.writeInt16LE;SlowBuffer.prototype.writeInt16BE=Buffer.prototype.writeInt16BE;SlowBuffer.prototype.writeInt32LE=Buffer.prototype.writeInt32LE;SlowBuffer.prototype.writeInt32BE=Buffer.prototype.writeInt32BE;SlowBuffer.prototype.writeFloatLE=Buffer.prototype.writeFloatLE;SlowBuffer.prototype.writeFloatBE=Buffer.prototype.writeFloatBE;SlowBuffer.prototype.writeDoubleLE=Buffer.prototype.writeDoubleLE;SlowBuffer.prototype.writeDoubleBE=Buffer.prototype.writeDoubleBE}()},{assert:2,"./buffer_ieee754":1,"base64-js":5}],3:[function(require,module,exports){var events=require("events");exports.isArray=isArray;exports.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.print=function(){};exports.puts=function(){};exports.debug=function(){};exports.inspect=function(obj,showHidden,depth,colors){var seen=[];var stylize=function(str,styleType){var styles={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};var style={special:"cyan",number:"blue","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"}[styleType];if(style){return"["+styles[style][0]+"m"+str+"["+styles[style][1]+"m"}else{return str}};if(!colors){stylize=function(str,styleType){return str}}function format(value,recurseTimes){if(value&&typeof value.inspect==="function"&&value!==exports&&!(value.constructor&&value.constructor.prototype===value)){return value.inspect(recurseTimes)}switch(typeof value){case"undefined":return stylize("undefined","undefined");case"string":var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(simple,"string");case"number":return stylize(""+value,"number");case"boolean":return stylize(""+value,"boolean")}if(value===null){return stylize("null","null")}var visible_keys=Object_keys(value);var keys=showHidden?Object_getOwnPropertyNames(value):visible_keys;if(typeof value==="function"&&keys.length===0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{var name=value.name?": "+value.name:"";return stylize("[Function"+name+"]","special")}}if(isDate(value)&&keys.length===0){return stylize(value.toUTCString(),"date")}var base,type,braces;if(isArray(value)){type="Array";braces=["[","]"]}else{type="Object";braces=["{","}"]}if(typeof value==="function"){var n=value.name?": "+value.name:"";base=isRegExp(value)?" "+value:" [Function"+n+"]"}else{base=""}if(isDate(value)){base=" "+value.toUTCString()}if(keys.length===0){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return stylize(""+value,"regexp")}else{return stylize("[Object]","special")}}seen.push(value);var output=keys.map(function(key){var name,str;if(value.__lookupGetter__){if(value.__lookupGetter__(key)){if(value.__lookupSetter__(key)){str=stylize("[Getter/Setter]","special")}else{str=stylize("[Getter]","special")}}else{if(value.__lookupSetter__(key)){str=stylize("[Setter]","special")}}}if(visible_keys.indexOf(key)<0){name="["+key+"]"}if(!str){if(seen.indexOf(value[key])<0){if(recurseTimes===null){str=format(value[key])}else{str=format(value[key],recurseTimes-1)}if(str.indexOf("\n")>-1){if(isArray(value)){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=stylize("[Circular]","special")}}if(typeof name==="undefined"){if(type==="Array"&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=stylize(name,"string")}}return name+": "+str});seen.pop();var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.length+1},0);if(length>50){output=braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}else{output=braces[0]+base+" "+output.join(", ")+" "+braces[1]}return output}return format(obj,typeof depth==="undefined"?2:depth)};function isArray(ar){return ar instanceof Array||Array.isArray(ar)||ar&&ar!==Object.prototype&&isArray(ar.__proto__)}function isRegExp(re){return re instanceof RegExp||typeof re==="object"&&Object.prototype.toString.call(re)==="[object RegExp]"}function isDate(d){if(d instanceof Date)return true;if(typeof d!=="object")return false;var properties=Date.prototype&&Object_getOwnPropertyNames(Date.prototype);var proto=d.__proto__&&Object_getOwnPropertyNames(d.__proto__);return JSON.stringify(proto)===JSON.stringify(properties)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(msg){};exports.pump=null;var Object_keys=Object.keys||function(obj){var res=[];for(var key in obj)res.push(key);return res};var Object_getOwnPropertyNames=Object.getOwnPropertyNames||function(obj){var res=[];for(var key in obj){if(Object.hasOwnProperty.call(obj,key))res.push(key)}return res};var Object_create=Object.create||function(prototype,properties){var object;if(prototype===null){object={__proto__:null}}else{if(typeof prototype!=="object"){throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'")}var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(typeof properties!=="undefined"&&Object.defineProperties){Object.defineProperties(object,properties)}return object};exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object_create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(typeof f!=="string"){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(exports.inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":return JSON.stringify(args[i++]);default:return x}});for(var x=args[i];i<len;x=args[++i]){if(x===null||typeof x!=="object"){str+=" "+x}else{str+=" "+exports.inspect(x)}}return str}},{events:6}],5:[function(require,module,exports){!function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64}()},{}],7:[function(require,module,exports){exports.readIEEE754=function(buffer,offset,isBE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isBE?0:nBytes-1,d=isBE?1:-1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.writeIEEE754=function(buffer,value,offset,isBE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isBE?nBytes-1:0,d=isBE?-1:1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],8:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],6:[function(require,module,exports){!function(process){if(!process.EventEmitter)process.EventEmitter=function(){};var EventEmitter=exports.EventEmitter=process.EventEmitter;var isArray=typeof Array.isArray==="function"?Array.isArray:function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function indexOf(xs,x){if(xs.indexOf)return xs.indexOf(x);for(var i=0;i<xs.length;i++){if(x===xs[i])return i}return-1}var defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!this._events)this._events={};this._events.maxListeners=n};EventEmitter.prototype.emit=function(type){if(type==="error"){if(!this._events||!this._events.error||isArray(this._events.error)&&!this._events.error.length){if(arguments[1]instanceof Error){throw arguments[1]}else{throw new Error("Uncaught, unspecified 'error' event.")}return false}}if(!this._events)return false;var handler=this._events[type];if(!handler)return false;if(typeof handler=="function"){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:var args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}return true}else if(isArray(handler)){var args=Array.prototype.slice.call(arguments,1);var listeners=handler.slice();for(var i=0,l=listeners.length;i<l;i++){listeners[i].apply(this,args)}return true}else{return false}};EventEmitter.prototype.addListener=function(type,listener){if("function"!==typeof listener){throw new Error("addListener only takes instances of Function")}if(!this._events)this._events={};this.emit("newListener",type,listener);if(!this._events[type]){this._events[type]=listener}else if(isArray(this._events[type])){if(!this._events[type].warned){var m;if(this._events.maxListeners!==undefined){m=this._events.maxListeners}else{m=defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);console.trace()}}this._events[type].push(listener)}else{this._events[type]=[this._events[type],listener]}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){var self=this;self.on(type,function g(){self.removeListener(type,g);listener.apply(this,arguments)});return this};EventEmitter.prototype.removeListener=function(type,listener){if("function"!==typeof listener){throw new Error("removeListener only takes instances of Function")}if(!this._events||!this._events[type])return this;var list=this._events[type];if(isArray(list)){var i=indexOf(list,listener);if(i<0)return this;list.splice(i,1);if(list.length==0)delete this._events[type]}else if(this._events[type]===listener){delete this._events[type]}return this};EventEmitter.prototype.removeAllListeners=function(type){if(arguments.length===0){this._events={};return this}if(type&&this._events&&this._events[type])this._events[type]=null;return this};EventEmitter.prototype.listeners=function(type){if(!this._events)this._events={};if(!this._events[type])this._events[type]=[];if(!isArray(this._events[type])){this._events[type]=[this._events[type]]}return this._events[type]}}(require("__browserify_process"))},{__browserify_process:8}],4:[function(require,module,exports){!function(){function SlowBuffer(size){this.length=size}var assert=require("assert");exports.INSPECT_MAX_BYTES=50;
function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)if(str.charCodeAt(i)<=127)byteArray.push(str.charCodeAt(i));else{var h=encodeURIComponent(str.charAt(i)).substr(1).split("%");for(var j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++)byteArray.push(str.charCodeAt(i)&255);return byteArray}function base64ToBytes(str){return require("base64-js").toByteArray(str)}SlowBuffer.byteLength=function(str,encoding){switch(encoding||"utf8"){case"hex":return str.length/2;case"utf8":case"utf-8":return utf8ToBytes(str).length;case"ascii":return str.length;case"base64":return base64ToBytes(str).length;default:throw new Error("Unknown encoding")}};function blitBuffer(src,dst,offset,length){var pos,i=0;while(i<length){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i];i++}return i}SlowBuffer.prototype.utf8Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(utf8ToBytes(string),this,offset,length)};SlowBuffer.prototype.asciiWrite=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(asciiToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Write=function(string,offset,length){var bytes,pos;return SlowBuffer._charsWritten=blitBuffer(base64ToBytes(string),this,offset,length)};SlowBuffer.prototype.base64Slice=function(start,end){var bytes=Array.prototype.slice.apply(this,arguments);return require("base64-js").fromByteArray(bytes)};function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}SlowBuffer.prototype.utf8Slice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var res="";var tmp="";var i=0;while(i<bytes.length){if(bytes[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(bytes[i]);tmp=""}else tmp+="%"+bytes[i].toString(16);i++}return res+decodeUtf8Char(tmp)};SlowBuffer.prototype.asciiSlice=function(){var bytes=Array.prototype.slice.apply(this,arguments);var ret="";for(var i=0;i<bytes.length;i++)ret+=String.fromCharCode(bytes[i]);return ret};SlowBuffer.prototype.inspect=function(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this[i]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<SlowBuffer "+out.join(" ")+">"};SlowBuffer.prototype.hexSlice=function(start,end){var len=this.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(this[i])}return out};SlowBuffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();start=+start||0;if(typeof end=="undefined")end=this.length;if(+end==start){return""}switch(encoding){case"hex":return this.hexSlice(start,end);case"utf8":case"utf-8":return this.utf8Slice(start,end);case"ascii":return this.asciiSlice(start,end);case"binary":return this.binarySlice(start,end);case"base64":return this.base64Slice(start,end);case"ucs2":case"ucs-2":return this.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.hexWrite=function(string,offset,length){offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2){throw new Error("Invalid hex string")}if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");this[offset+i]=byte}SlowBuffer._charsWritten=i*2;return i};SlowBuffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();switch(encoding){case"hex":return this.hexWrite(string,offset,length);case"utf8":case"utf-8":return this.utf8Write(string,offset,length);case"ascii":return this.asciiWrite(string,offset,length);case"binary":return this.binaryWrite(string,offset,length);case"base64":return this.base64Write(string,offset,length);case"ucs2":case"ucs-2":return this.ucs2Write(string,offset,length);default:throw new Error("Unknown encoding")}};SlowBuffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length){throw new Error("oob")}if(start>end){throw new Error("oob")}return new Buffer(this,end-start,+start)};SlowBuffer.prototype.copy=function(target,targetstart,sourcestart,sourceend){var temp=[];for(var i=sourcestart;i<sourceend;i++){assert.ok(typeof this[i]!=="undefined","copying undefined buffer bytes!");temp.push(this[i])}for(var i=targetstart;i<targetstart+temp.length;i++){target[i]=temp[i-targetstart]}};function coerce(length){length=~~Math.ceil(+length);return length<0?0:length}function Buffer(subject,encoding,offset){if(!(this instanceof Buffer)){return new Buffer(subject,encoding,offset)}var type;if(typeof offset==="number"){this.length=coerce(encoding);this.parent=subject;this.offset=offset}else{switch(type=typeof subject){case"number":this.length=coerce(subject);break;case"string":this.length=Buffer.byteLength(subject,encoding);break;case"object":this.length=coerce(subject.length);break;default:throw new Error("First argument needs to be a number, "+"array or string.")}if(this.length>Buffer.poolSize){this.parent=new SlowBuffer(this.length);this.offset=0}else{if(!pool||pool.length-pool.used<this.length)allocPool();this.parent=pool;this.offset=pool.used;pool.used+=this.length}if(isArrayIsh(subject)){for(var i=0;i<this.length;i++){this.parent[i+this.offset]=subject[i]}}else if(type=="string"){this.length=this.write(subject,0,encoding)}}}function isArrayIsh(subject){return Array.isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}exports.SlowBuffer=SlowBuffer;exports.Buffer=Buffer;Buffer.poolSize=8*1024;var pool;function allocPool(){pool=new SlowBuffer(Buffer.poolSize);pool.used=0}Buffer.isBuffer=function isBuffer(b){return b instanceof Buffer||b instanceof SlowBuffer};Buffer.concat=function(list,totalLength){if(!Array.isArray(list)){throw new Error("Usage: Buffer.concat(list, [totalLength])\n       list should be an Array.")}if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}if(typeof totalLength!=="number"){totalLength=0;for(var i=0;i<list.length;i++){var buf=list[i];totalLength+=buf.length}}var buffer=new Buffer(totalLength);var pos=0;for(var i=0;i<list.length;i++){var buf=list[i];buf.copy(buffer,pos);pos+=buf.length}return buffer};Buffer.prototype.inspect=function inspect(){var out=[],len=this.length;for(var i=0;i<len;i++){out[i]=toHex(this.parent[i+this.offset]);if(i==exports.INSPECT_MAX_BYTES){out[i+1]="...";break}}return"<Buffer "+out.join(" ")+">"};Buffer.prototype.get=function get(i){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]};Buffer.prototype.set=function set(i,v){if(i<0||i>=this.length)throw new Error("oob");return this.parent[this.offset+i]=v};Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=+offset||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=this.parent.hexWrite(string,this.offset+offset,length);break;case"utf8":case"utf-8":ret=this.parent.utf8Write(string,this.offset+offset,length);break;case"ascii":ret=this.parent.asciiWrite(string,this.offset+offset,length);break;case"binary":ret=this.parent.binaryWrite(string,this.offset+offset,length);break;case"base64":ret=this.parent.base64Write(string,this.offset+offset,length);break;case"ucs2":case"ucs-2":ret=this.parent.ucs2Write(string,this.offset+offset,length);break;default:throw new Error("Unknown encoding")}Buffer._charsWritten=SlowBuffer._charsWritten;return ret};Buffer.prototype.toString=function(encoding,start,end){encoding=String(encoding||"utf8").toLowerCase();if(typeof start=="undefined"||start<0){start=0}else if(start>this.length){start=this.length}if(typeof end=="undefined"||end>this.length){end=this.length}else if(end<0){end=0}start=start+this.offset;end=end+this.offset;switch(encoding){case"hex":return this.parent.hexSlice(start,end);case"utf8":case"utf-8":return this.parent.utf8Slice(start,end);case"ascii":return this.parent.asciiSlice(start,end);case"binary":return this.parent.binarySlice(start,end);case"base64":return this.parent.base64Slice(start,end);case"ucs2":case"ucs-2":return this.parent.ucs2Slice(start,end);default:throw new Error("Unknown encoding")}};Buffer.byteLength=SlowBuffer.byteLength;Buffer.prototype.fill=function fill(value,start,end){value||(value=0);start||(start=0);end||(end=this.length);if(typeof value==="string"){value=value.charCodeAt(0)}if(!(typeof value==="number")||isNaN(value)){throw new Error("value is not a number")}if(end<start)throw new Error("end < start");if(end===start)return 0;if(this.length==0)return 0;if(start<0||start>=this.length){throw new Error("start out of bounds")}if(end<0||end>this.length){throw new Error("end out of bounds")}return this.parent.fill(value,start+this.offset,end+this.offset)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;start||(start=0);end||(end=this.length);target_start||(target_start=0);if(end<start)throw new Error("sourceEnd < sourceStart");if(end===start)return 0;if(target.length==0||source.length==0)return 0;if(target_start<0||target_start>=target.length){throw new Error("targetStart out of bounds")}if(start<0||start>=source.length){throw new Error("sourceStart out of bounds")}if(end<0||end>source.length){throw new Error("sourceEnd out of bounds")}if(end>this.length){end=this.length}if(target.length-target_start<end-start){end=target.length-target_start+start}return this.parent.copy(target.parent,target_start+target.offset,start+this.offset,end+this.offset)};Buffer.prototype.slice=function(start,end){if(end===undefined)end=this.length;if(end>this.length)throw new Error("oob");if(start>end)throw new Error("oob");return new Buffer(this.parent,end-start,+start+this.offset)};Buffer.prototype.utf8Slice=function(start,end){return this.toString("utf8",start,end)};Buffer.prototype.binarySlice=function(start,end){return this.toString("binary",start,end)};Buffer.prototype.asciiSlice=function(start,end){return this.toString("ascii",start,end)};Buffer.prototype.utf8Write=function(string,offset){return this.write(string,offset,"utf8")};Buffer.prototype.binaryWrite=function(string,offset){return this.write(string,offset,"binary")};Buffer.prototype.asciiWrite=function(string,offset){return this.write(string,offset,"ascii")};Buffer.prototype.readUInt8=function(offset,noAssert){var buffer=this;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}return buffer.parent[buffer.offset+offset]};function readUInt16(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset]<<8;val|=buffer.parent[buffer.offset+offset+1]}else{val=buffer.parent[buffer.offset+offset];val|=buffer.parent[buffer.offset+offset+1]<<8}return val}Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,false,noAssert)};Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,true,noAssert)};function readUInt32(buffer,offset,isBigEndian,noAssert){var val=0;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}if(isBigEndian){val=buffer.parent[buffer.offset+offset+1]<<16;val|=buffer.parent[buffer.offset+offset+2]<<8;val|=buffer.parent[buffer.offset+offset+3];val=val+(buffer.parent[buffer.offset+offset]<<24>>>0)}else{val=buffer.parent[buffer.offset+offset+2]<<16;val|=buffer.parent[buffer.offset+offset+1]<<8;val|=buffer.parent[buffer.offset+offset];val=val+(buffer.parent[buffer.offset+offset+3]<<24>>>0)}return val}Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,false,noAssert)};Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,true,noAssert)};Buffer.prototype.readInt8=function(offset,noAssert){var buffer=this;var neg;if(!noAssert){assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to read beyond buffer length")}neg=buffer.parent[buffer.offset+offset]&128;if(!neg){return buffer.parent[buffer.offset+offset]}return(255-buffer.parent[buffer.offset+offset]+1)*-1};function readInt16(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to read beyond buffer length")}val=readUInt16(buffer,offset,isBigEndian,noAssert);neg=val&32768;if(!neg){return val}return(65535-val+1)*-1}Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,false,noAssert)};Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,true,noAssert)};function readInt32(buffer,offset,isBigEndian,noAssert){var neg,val;if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}val=readUInt32(buffer,offset,isBigEndian,noAssert);neg=val&2147483648;if(!neg){return val}return(4294967295-val+1)*-1}Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,false,noAssert)};Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,true,noAssert)};function readFloat(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+3<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,23,4)}Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,false,noAssert)};Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,true,noAssert)};function readDouble(buffer,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset+7<buffer.length,"Trying to read beyond buffer length")}return require("./buffer_ieee754").readIEEE754(buffer,offset,isBigEndian,52,8)}Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,false,noAssert)};Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,true,noAssert)};function verifuint(value,max){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value>=0,"specified a negative value for writing an unsigned value");assert.ok(value<=max,"value is larger than maximum value for type");assert.ok(Math.floor(value)===value,"value has a fractional component")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"trying to write beyond buffer length");verifuint(value,255)}buffer.parent[buffer.offset+offset]=value};function writeUInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"trying to write beyond buffer length");verifuint(value,65535)}if(isBigEndian){buffer.parent[buffer.offset+offset]=(value&65280)>>>8;buffer.parent[buffer.offset+offset+1]=value&255}else{buffer.parent[buffer.offset+offset+1]=(value&65280)>>>8;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){writeUInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){writeUInt16(this,value,offset,true,noAssert)};function writeUInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"trying to write beyond buffer length");verifuint(value,4294967295)}if(isBigEndian){buffer.parent[buffer.offset+offset]=value>>>24&255;buffer.parent[buffer.offset+offset+1]=value>>>16&255;buffer.parent[buffer.offset+offset+2]=value>>>8&255;buffer.parent[buffer.offset+offset+3]=value&255}else{buffer.parent[buffer.offset+offset+3]=value>>>24&255;buffer.parent[buffer.offset+offset+2]=value>>>16&255;buffer.parent[buffer.offset+offset+1]=value>>>8&255;buffer.parent[buffer.offset+offset]=value&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){writeUInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){writeUInt32(this,value,offset,true,noAssert)};function verifsint(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value");assert.ok(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert.ok(typeof value=="number","cannot write a non-number as a number");assert.ok(value<=max,"value larger than maximum allowed value");assert.ok(value>=min,"value smaller than minimum allowed value")}Buffer.prototype.writeInt8=function(value,offset,noAssert){var buffer=this;if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset<buffer.length,"Trying to write beyond buffer length");verifsint(value,127,-128)}if(value>=0){buffer.writeUInt8(value,offset,noAssert)}else{buffer.writeUInt8(255+value+1,offset,noAssert)}};function writeInt16(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+1<buffer.length,"Trying to write beyond buffer length");verifsint(value,32767,-32768)}if(value>=0){writeUInt16(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt16(buffer,65535+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt16LE=function(value,offset,noAssert){writeInt16(this,value,offset,false,noAssert)};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){writeInt16(this,value,offset,true,noAssert)};function writeInt32(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifsint(value,2147483647,-2147483648)}if(value>=0){writeUInt32(buffer,value,offset,isBigEndian,noAssert)}else{writeUInt32(buffer,4294967295+value+1,offset,isBigEndian,noAssert)}}Buffer.prototype.writeInt32LE=function(value,offset,noAssert){writeInt32(this,value,offset,false,noAssert)};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){writeInt32(this,value,offset,true,noAssert)};function writeFloat(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+3<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,23,4)}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){writeFloat(this,value,offset,false,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){writeFloat(this,value,offset,true,noAssert)};function writeDouble(buffer,value,offset,isBigEndian,noAssert){if(!noAssert){assert.ok(value!==undefined&&value!==null,"missing value");assert.ok(typeof isBigEndian==="boolean","missing or invalid endian");assert.ok(offset!==undefined&&offset!==null,"missing offset");assert.ok(offset+7<buffer.length,"Trying to write beyond buffer length");verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308)}require("./buffer_ieee754").writeIEEE754(buffer,value,offset,isBigEndian,52,8)}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){writeDouble(this,value,offset,true,noAssert)};SlowBuffer.prototype.readUInt8=Buffer.prototype.readUInt8;SlowBuffer.prototype.readUInt16LE=Buffer.prototype.readUInt16LE;SlowBuffer.prototype.readUInt16BE=Buffer.prototype.readUInt16BE;SlowBuffer.prototype.readUInt32LE=Buffer.prototype.readUInt32LE;SlowBuffer.prototype.readUInt32BE=Buffer.prototype.readUInt32BE;SlowBuffer.prototype.readInt8=Buffer.prototype.readInt8;SlowBuffer.prototype.readInt16LE=Buffer.prototype.readInt16LE;SlowBuffer.prototype.readInt16BE=Buffer.prototype.readInt16BE;SlowBuffer.prototype.readInt32LE=Buffer.prototype.readInt32LE;SlowBuffer.prototype.readInt32BE=Buffer.prototype.readInt32BE;SlowBuffer.prototype.readFloatLE=Buffer.prototype.readFloatLE;SlowBuffer.prototype.readFloatBE=Buffer.prototype.readFloatBE;SlowBuffer.prototype.readDoubleLE=Buffer.prototype.readDoubleLE;SlowBuffer.prototype.readDoubleBE=Buffer.prototype.readDoubleBE;SlowBuffer.prototype.writeUInt8=Buffer.prototype.writeUInt8;SlowBuffer.prototype.writeUInt16LE=Buffer.prototype.writeUInt16LE;SlowBuffer.prototype.writeUInt16BE=Buffer.prototype.writeUInt16BE;SlowBuffer.prototype.writeUInt32LE=Buffer.prototype.writeUInt32LE;SlowBuffer.prototype.writeUInt32BE=Buffer.prototype.writeUInt32BE;SlowBuffer.prototype.writeInt8=Buffer.prototype.writeInt8;SlowBuffer.prototype.writeInt16LE=Buffer.prototype.writeInt16LE;SlowBuffer.prototype.writeInt16BE=Buffer.prototype.writeInt16BE;SlowBuffer.prototype.writeInt32LE=Buffer.prototype.writeInt32LE;SlowBuffer.prototype.writeInt32BE=Buffer.prototype.writeInt32BE;SlowBuffer.prototype.writeFloatLE=Buffer.prototype.writeFloatLE;SlowBuffer.prototype.writeFloatBE=Buffer.prototype.writeFloatBE;SlowBuffer.prototype.writeDoubleLE=Buffer.prototype.writeDoubleLE;SlowBuffer.prototype.writeDoubleBE=Buffer.prototype.writeDoubleBE}()},{assert:2,"./buffer_ieee754":7,"base64-js":9}],9:[function(require,module,exports){!function(exports){"use strict";var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw"Invalid string. Length must be a multiple of 4"}placeHolders=b64.indexOf("=");placeHolders=placeHolders>0?b64.length-placeHolders:0;arr=[];l=placeHolders>0?b64.length-4:b64.length;for(i=0,j=0;i<l;i+=4,j+=3){tmp=lookup.indexOf(b64[i])<<18|lookup.indexOf(b64[i+1])<<12|lookup.indexOf(b64[i+2])<<6|lookup.indexOf(b64[i+3]);arr.push((tmp&16711680)>>16);arr.push((tmp&65280)>>8);arr.push(tmp&255)}if(placeHolders===2){tmp=lookup.indexOf(b64[i])<<2|lookup.indexOf(b64[i+1])>>4;arr.push(tmp&255)}else if(placeHolders===1){tmp=lookup.indexOf(b64[i])<<10|lookup.indexOf(b64[i+1])<<4|lookup.indexOf(b64[i+2])>>2;arr.push(tmp>>8&255);arr.push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=lookup[temp>>2];output+=lookup[temp<<4&63];output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=lookup[temp>>10];output+=lookup[temp>>4&63];output+=lookup[temp<<2&63];output+="=";break}return output}module.exports.toByteArray=b64ToByteArray;module.exports.fromByteArray=uint8ToBase64}()},{}]},{},[]);module.exports=require("buffer-browserify")},{}],55:[function(require,module,exports){!function(Buffer){!function(){var _global=this;var _rng;if(typeof require=="function"){try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}var BufferClass=typeof Buffer=="function"?Buffer:Array;var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!=null?options.clockseq:_clockseq;var msecs=options.msecs!=null?options.msecs:(new Date).getTime();var nsecs=options.nsecs!=null?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq==null){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs==null){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new BufferClass(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;uuid.BufferClass=BufferClass;if(_global.define&&define.amd){define(function(){return uuid})}else if(typeof module!="undefined"&&module.exports){module.exports=uuid}else{var _previousRoot=_global.uuid;uuid.noConflict=function(){_global.uuid=_previousRoot;return uuid};_global.uuid=uuid}}()}(require("__browserify_buffer").Buffer)},{crypto:40,__browserify_buffer:59}],54:[function(require,module,exports){!function(global){!function(window){var undefined;var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){window=freeGlobal}var idCounter=0;var indicatorObject={};var keyPrefix=+new Date+"";var largeArraySize=200;var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reInterpolate=/<%=([\s\S]+?)%>/g;var reLeadingZeros=/^0+(?=.$)/;var reNoMatch=/($^)/;var reUnescapedHtml=/[&<>"']/g;var reUnescapedString=/['\n\r\t\u2028\u2029\\]/g;var contextProps=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"];var templateCounter=0;var argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]";var cloneableClasses={};cloneableClasses[funcClass]=false;cloneableClasses[argsClass]=cloneableClasses[arrayClass]=cloneableClasses[boolClass]=cloneableClasses[dateClass]=cloneableClasses[numberClass]=cloneableClasses[objectClass]=cloneableClasses[regexpClass]=cloneableClasses[stringClass]=true;var objectTypes={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"};function runInContext(context){context=context?_.defaults(window.Object(),context,_.pick(window,contextProps)):window;var Array=context.Array,Boolean=context.Boolean,Date=context.Date,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayRef=Array(),objectRef=Object();var oldDash=context._;var reNative=RegExp("^"+String(objectRef.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$");var ceil=Math.ceil,clearTimeout=context.clearTimeout,concat=arrayRef.concat,floor=Math.floor,getPrototypeOf=reNative.test(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,hasOwnProperty=objectRef.hasOwnProperty,push=arrayRef.push,setImmediate=context.setImmediate,setTimeout=context.setTimeout,toString=objectRef.toString;var nativeBind=reNative.test(nativeBind=toString.bind)&&nativeBind,nativeIsArray=reNative.test(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=context.isFinite,nativeIsNaN=context.isNaN,nativeKeys=reNative.test(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeSlice=arrayRef.slice;var isIeOpera=reNative.test(context.attachEvent),isV8=nativeBind&&!/\n|true/.test(nativeBind+isIeOpera);var ctorByClass={};ctorByClass[arrayClass]=Array;ctorByClass[boolClass]=Boolean;ctorByClass[dateClass]=Date;ctorByClass[objectClass]=Object;ctorByClass[numberClass]=Number;ctorByClass[regexpClass]=RegExp;ctorByClass[stringClass]=String;function lodash(value){return value&&typeof value=="object"&&!isArray(value)&&hasOwnProperty.call(value,"__wrapped__")?value:new lodashWrapper(value)
}var support=lodash.support={};support.fastBind=nativeBind&&!isV8;lodash.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:"",imports:{_:lodash}};function cachedContains(array){var length=array.length,isLarge=length>=largeArraySize;if(isLarge){var cache={},index=-1;while(++index<length){var key=keyPrefix+array[index];(cache[key]||(cache[key]=[])).push(array[index])}}return function(value){if(isLarge){var key=keyPrefix+value;return cache[key]&&indexOf(cache[key],value)>-1}return indexOf(array,value)>-1}}function charAtCallback(value){return value.charCodeAt(0)}function compareAscending(a,b){var ai=a.index,bi=b.index;a=a.criteria;b=b.criteria;if(a!==b){if(a>b||typeof a=="undefined"){return 1}if(a<b||typeof b=="undefined"){return-1}}return ai<bi?-1:1}function createBound(func,thisArg,partialArgs,indicator){var isFunc=isFunction(func),isPartial=!partialArgs,key=thisArg;if(isPartial){var rightIndicator=indicator;partialArgs=thisArg}else if(!isFunc){if(!indicator){throw new TypeError}thisArg=func}function bound(){var args=arguments,thisBinding=isPartial?this:thisArg;if(!isFunc){func=thisArg[key]}if(partialArgs.length){args=args.length?(args=nativeSlice.call(args),rightIndicator?args.concat(partialArgs):partialArgs.concat(args)):partialArgs}if(this instanceof bound){noop.prototype=func.prototype;thisBinding=new noop;noop.prototype=null;var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}return bound}function escapeStringChar(match){return"\\"+stringEscapes[match]}function escapeHtmlChar(match){return htmlEscapes[match]}function lodashWrapper(value){this.__wrapped__=value}lodashWrapper.prototype=lodash.prototype;function noop(){}function shimIsPlainObject(value){var result=false;if(!(value&&toString.call(value)==objectClass)){return result}var ctor=value.constructor;if(isFunction(ctor)?ctor instanceof ctor:support.nodeClass||!isNode(value)){forIn(value,function(value,key){result=key});return result===false||hasOwnProperty.call(value,result)}return result}function slice(array,start,end){start||(start=0);if(typeof end=="undefined"){end=array?array.length:0}var index=-1,length=end-start||0,result=Array(length<0?0:length);while(++index<length){result[index]=array[start+index]}return result}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return toString.call(value)==argsClass}var shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable){if(hasOwnProperty.call(iterable,index)){result.push(index)}}return result};var keys=!nativeKeys?shimKeys:function(object){if(!isObject(object)){return[]}return nativeKeys(object)};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var htmlUnescapes=invert(htmlEscapes);var assign=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=="number"?2:args.length;if(argsLength>3&&typeof args[argsLength-2]=="function"){var callback=lodash.createCallback(args[--argsLength-1],args[argsLength--],2)}else if(argsLength>2&&typeof args[argsLength-1]=="function"){callback=args[--argsLength]}while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var length=iterable.length;index=-1;if(isArray(iterable)){while(++index<length){result[index]=callback?callback(result[index],iterable[index]):iterable[index]}}else{var ownIndex=-1,ownProps=objectTypes[typeof iterable]?keys(iterable):[],length=ownProps.length;while(++ownIndex<length){index=ownProps[ownIndex];result[index]=callback?callback(result[index],iterable[index]):iterable[index]}}}}return result};function clone(value,deep,callback,thisArg,stackA,stackB){var result=value;if(typeof deep=="function"){thisArg=callback;callback=deep;deep=false}if(typeof callback=="function"){callback=typeof thisArg=="undefined"?callback:lodash.createCallback(callback,thisArg,1);result=callback(result);if(typeof result!="undefined"){return result}result=value}var isObj=isObject(result);if(isObj){var className=toString.call(result);if(!cloneableClasses[className]){return result}var isArr=isArray(result)}if(!isObj||!deep){return isObj?isArr?slice(result):assign({},result):result}var ctor=ctorByClass[className];switch(className){case boolClass:case dateClass:return new ctor(+result);case numberClass:case stringClass:return new ctor(result);case regexpClass:return ctor(result.source,reFlags.exec(result))}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length]}}result=isArr?ctor(result.length):{};if(isArr){if(hasOwnProperty.call(value,"index")){result.index=value.index}if(hasOwnProperty.call(value,"input")){result.input=value.input}}stackA.push(value);stackB.push(result);(isArr?forEach:forOwn)(value,function(objValue,key){result[key]=clone(objValue,deep,callback,undefined,stackA,stackB)});return result}function cloneDeep(value,callback,thisArg){return clone(value,true,callback,thisArg)}var defaults=function(object,source,guard){var index,iterable=object,result=iterable;if(!iterable)return result;var args=arguments,argsIndex=0,argsLength=typeof guard=="number"?2:args.length;while(++argsIndex<argsLength){iterable=args[argsIndex];if(iterable&&objectTypes[typeof iterable]){var length=iterable.length;index=-1;if(isArray(iterable)){while(++index<length){if(typeof result[index]=="undefined")result[index]=iterable[index]}}else{var ownIndex=-1,ownProps=objectTypes[typeof iterable]?keys(iterable):[],length=ownProps.length;while(++ownIndex<length){index=ownProps[ownIndex];if(typeof result[index]=="undefined")result[index]=iterable[index]}}}}return result};function findKey(object,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg);forOwn(object,function(value,key,object){if(callback(value,key,object)){result=key;return false}});return result}var forIn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=="undefined"?callback:lodash.createCallback(callback,thisArg);for(index in iterable){if(callback(iterable[index],index,collection)===false)return result}return result};var forOwn=function(collection,callback,thisArg){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;callback=callback&&typeof thisArg=="undefined"?callback:lodash.createCallback(callback,thisArg);var ownIndex=-1,ownProps=objectTypes[typeof iterable]?keys(iterable):[],length=ownProps.length;while(++ownIndex<length){index=ownProps[ownIndex];if(callback(iterable[index],index,collection)===false)return result}return result};function functions(object){var result=[];forIn(object,function(value,key){if(isFunction(value)){result.push(key)}});return result.sort()}function has(object,property){return object?hasOwnProperty.call(object,property):false}function invert(object){var index=-1,props=keys(object),length=props.length,result={};while(++index<length){var key=props[index];result[object[key]]=key}return result}function isArray(value){return value instanceof Array||nativeIsArray(value)}function isBoolean(value){return value===true||value===false||toString.call(value)==boolClass}function isDate(value){return value instanceof Date||toString.call(value)==dateClass}function isElement(value){return value?value.nodeType===1:false}function isEmpty(value){var result=true;if(!value){return result}var className=toString.call(value),length=value.length;if(className==arrayClass||className==stringClass||className==argsClass||className==objectClass&&typeof length=="number"&&isFunction(value.splice)){return!length}forOwn(value,function(){return result=false});return result}function isEqual(a,b,callback,thisArg,stackA,stackB){var whereIndicator=callback===indicatorObject;if(typeof callback=="function"&&!whereIndicator){callback=lodash.createCallback(callback,thisArg,2);var result=callback(a,b);if(typeof result!="undefined"){return!!result}}if(a===b){return a!==0||1/a==1/b}var type=typeof a,otherType=typeof b;if(a===a&&(!a||type!="function"&&type!="object")&&(!b||otherType!="function"&&otherType!="object")){return false}if(a==null||b==null){return a===b}var className=toString.call(a),otherClass=toString.call(b);if(className==argsClass){className=objectClass}if(otherClass==argsClass){otherClass=objectClass}if(className!=otherClass){return false}switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){if(hasOwnProperty.call(a,"__wrapped__ ")||hasOwnProperty.call(b,"__wrapped__")){return isEqual(a.__wrapped__||a,b.__wrapped__||b,callback,thisArg,stackA,stackB)}if(className!=objectClass){return false}var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)){return false}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==a){return stackB[length]==b}}var size=0;result=true;stackA.push(a);stackB.push(b);if(isArr){length=a.length;size=b.length;result=size==a.length;if(!result&&!whereIndicator){return result}while(size--){var index=length,value=b[size];if(whereIndicator){while(index--){if(result=isEqual(a[index],value,callback,thisArg,stackA,stackB)){break}}}else if(!(result=isEqual(a[size],value,callback,thisArg,stackA,stackB))){break}}return result}forIn(b,function(value,key,b){if(hasOwnProperty.call(b,key)){size++;return result=hasOwnProperty.call(a,key)&&isEqual(a[key],value,callback,thisArg,stackA,stackB)}});if(result&&!whereIndicator){forIn(a,function(value,key,a){if(hasOwnProperty.call(a,key)){return result=--size>-1}})}return result}function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value))}function isFunction(value){return typeof value=="function"}function isObject(value){return value?objectTypes[typeof value]:false}function isNaN(value){return isNumber(value)&&value!=+value}function isNull(value){return value===null}function isNumber(value){return typeof value=="number"||toString.call(value)==numberClass}var isPlainObject=function(value){if(!(value&&toString.call(value)==objectClass)){return false}var valueOf=value.valueOf,objProto=typeof valueOf=="function"&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)};function isRegExp(value){return value instanceof RegExp||toString.call(value)==regexpClass}function isString(value){return typeof value=="string"||toString.call(value)==stringClass}function isUndefined(value){return typeof value=="undefined"}function merge(object,source,deepIndicator){var args=arguments,index=0,length=2;if(!isObject(object)){return object}if(deepIndicator===indicatorObject){var callback=args[3],stackA=args[4],stackB=args[5]}else{stackA=[];stackB=[];if(typeof deepIndicator!="number"){length=args.length}if(length>3&&typeof args[length-2]=="function"){callback=lodash.createCallback(args[--length-1],args[length--],2)}else if(length>2&&typeof args[length-1]=="function"){callback=args[--length]}}while(++index<length){(isArray(args[index])?forEach:forOwn)(args[index],function(source,key){var found,isArr,result=source,value=object[key];if(source&&((isArr=isArray(source))||isPlainObject(source))){var stackLength=stackA.length;while(stackLength--){if(found=stackA[stackLength]==source){value=stackB[stackLength];break}}if(!found){var isShallow;if(callback){result=callback(value,source);if(isShallow=typeof result!="undefined"){value=result}}if(!isShallow){value=isArr?isArray(value)?value:[]:isPlainObject(value)?value:{}}stackA.push(source);stackB.push(value);if(!isShallow){value=merge(value,source,indicatorObject,callback,stackA,stackB)}}}else{if(callback){result=callback(value,source);if(typeof result=="undefined"){result=source}}if(typeof result!="undefined"){value=result}}object[key]=value})}return object}function omit(object,callback,thisArg){var isFunc=typeof callback=="function",result={};if(isFunc){callback=lodash.createCallback(callback,thisArg)}else{var props=concat.apply(arrayRef,nativeSlice.call(arguments,1))}forIn(object,function(value,key,object){if(isFunc?!callback(value,key,object):indexOf(props,key)<0){result[key]=value}});return result}function pairs(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object,callback,thisArg){var result={};if(typeof callback!="function"){var index=-1,props=concat.apply(arrayRef,nativeSlice.call(arguments,1)),length=isObject(object)?props.length:0;while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}}else{callback=lodash.createCallback(callback,thisArg);forIn(object,function(value,key,object){if(callback(value,key,object)){result[key]=value}})}return result}function values(object){var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}function at(collection){var index=-1,props=concat.apply(arrayRef,nativeSlice.call(arguments,1)),length=props.length,result=Array(length);while(++index<length){result[index]=collection[props[index]]}return result}function contains(collection,target,fromIndex){var index=-1,length=collection?collection.length:0,result=false;fromIndex=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex)||0;if(typeof length=="number"){result=(isString(collection)?collection.indexOf(target,fromIndex):indexOf(collection,target,fromIndex))>-1}else{forOwn(collection,function(value){if(++index>=fromIndex){return!(result=value===target)}})}return result}function countBy(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=String(callback(value,key,collection));hasOwnProperty.call(result,key)?result[key]++:result[key]=1});return result}function every(collection,callback,thisArg){var result=true;callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=="number"){while(++index<length){if(!(result=!!callback(collection[index],index,collection))){break}}}else{forOwn(collection,function(value,index,collection){return result=!!callback(value,index,collection)})}return result}function filter(collection,callback,thisArg){var result=[];callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=="number"){while(++index<length){var value=collection[index];if(callback(value,index,collection)){result.push(value)}}}else{forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result.push(value)}})}return result}function find(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=="number"){while(++index<length){var value=collection[index];if(callback(value,index,collection)){return value}}}else{var result;forOwn(collection,function(value,index,collection){if(callback(value,index,collection)){result=value;return false}});return result}}function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=callback&&typeof thisArg=="undefined"?callback:lodash.createCallback(callback,thisArg);if(typeof length=="number"){while(++index<length){if(callback(collection[index],index,collection)===false){break}}}else{forOwn(collection,callback)}return collection}function groupBy(collection,callback,thisArg){var result={};callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){key=String(callback(value,key,collection));(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)});return result}function invoke(collection,methodName){var args=nativeSlice.call(arguments,2),index=-1,isFunc=typeof methodName=="function",length=collection?collection.length:0,result=Array(typeof length=="number"?length:0);forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args)});return result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;callback=lodash.createCallback(callback,thisArg);if(typeof length=="number"){var result=Array(length);while(++index<length){result[index]=callback(collection[index],index,collection)}}else{result=[];forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)})}return result}function max(collection,callback,thisArg){var computed=-Infinity,result=computed;if(!callback&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value>result){result=value}}}else{callback=!callback&&isString(collection)?charAtCallback:lodash.createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current>computed){computed=current;result=value}})}return result}function min(collection,callback,thisArg){var computed=Infinity,result=computed;if(!callback&&isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];if(value<result){result=value}}}else{callback=!callback&&isString(collection)?charAtCallback:lodash.createCallback(callback,thisArg);forEach(collection,function(value,index,collection){var current=callback(value,index,collection);if(current<computed){computed=current;result=value}})}return result}function pluck(collection,property){var index=-1,length=collection?collection.length:0;if(typeof length=="number"){var result=Array(length);while(++index<length){result[index]=collection[index][property]}}return result||map(collection,property)}function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=lodash.createCallback(callback,thisArg,4);var index=-1,length=collection.length;if(typeof length=="number"){if(noaccum){accumulator=collection[++index]}while(++index<length){accumulator=callback(accumulator,collection[index],index,collection)}}else{forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=false,value):callback(accumulator,value,index,collection)})}return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var iterable=collection,length=collection?collection.length:0,noaccum=arguments.length<3;if(typeof length!="number"){var props=keys(collection);length=props.length}callback=lodash.createCallback(callback,thisArg,4);forEach(collection,function(value,index,collection){index=props?props[--length]:--length;accumulator=noaccum?(noaccum=false,iterable[index]):callback(accumulator,iterable[index],index,collection)});return accumulator}function reject(collection,callback,thisArg){callback=lodash.createCallback(callback,thisArg);return filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array(typeof length=="number"?length:0);forEach(collection,function(value){var rand=floor(nativeRandom()*(++index+1));result[index]=result[rand];result[rand]=value});return result}function size(collection){var length=collection?collection.length:0;return typeof length=="number"?length:keys(collection).length}function some(collection,callback,thisArg){var result;callback=lodash.createCallback(callback,thisArg);var index=-1,length=collection?collection.length:0;if(typeof length=="number"){while(++index<length){if(result=callback(collection[index],index,collection)){break}}}else{forOwn(collection,function(value,index,collection){return!(result=callback(value,index,collection))})}return!!result}function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array(typeof length=="number"?length:0);callback=lodash.createCallback(callback,thisArg);forEach(collection,function(value,key,collection){result[++index]={criteria:callback(value,key,collection),index:index,value:value}});length=result.length;result.sort(compareAscending);while(length--){result[length]=result[length].value}return result}function toArray(collection){if(collection&&typeof collection.length=="number"){return slice(collection)}return values(collection)}var where=filter;function compact(array){var index=-1,length=array?array.length:0,result=[];while(++index<length){var value=array[index];if(value){result.push(value)}}return result}function difference(array){var index=-1,length=array?array.length:0,flattened=concat.apply(arrayRef,nativeSlice.call(arguments,1)),contains=cachedContains(flattened),result=[];while(++index<length){var value=array[index];if(!contains(value)){result.push(value)}}return result}function findIndex(array,callback,thisArg){var index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg);while(++index<length){if(callback(array[index],index,array)){return index}}return-1}function first(array,callback,thisArg){if(array){var n=0,length=array.length;if(typeof callback!="number"&&callback!=null){var index=-1;callback=lodash.createCallback(callback,thisArg);while(++index<length&&callback(array[index],index,array)){n++}}else{n=callback;if(n==null||thisArg){return array[0]}}return slice(array,0,nativeMin(nativeMax(0,n),length))}}function flatten(array,isShallow,callback,thisArg){var index=-1,length=array?array.length:0,result=[];if(typeof isShallow!="boolean"&&isShallow!=null){thisArg=callback;callback=isShallow;isShallow=false}if(callback!=null){callback=lodash.createCallback(callback,thisArg)}while(++index<length){var value=array[index];if(callback){value=callback(value,index,array)}if(isArray(value)){push.apply(result,isShallow?value:flatten(value))}else{result.push(value)}}return result}function indexOf(array,value,fromIndex){var index=-1,length=array?array.length:0;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(0,length+fromIndex):fromIndex||0)-1}else if(fromIndex){index=sortedIndex(array,value);return array[index]===value?index:-1}while(++index<length){if(array[index]===value){return index}}return-1}function initial(array,callback,thisArg){if(!array){return[]}var n=0,length=array.length;if(typeof callback!="number"&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg);while(index--&&callback(array[index],index,array)){n++}}else{n=callback==null||thisArg?1:callback||n}return slice(array,0,nativeMin(nativeMax(0,length-n),length))}function intersection(array){var args=arguments,argsLength=args.length,cache={0:{}},index=-1,length=array?array.length:0,isLarge=length>=largeArraySize,result=[],seen=result;outer:while(++index<length){var value=array[index];if(isLarge){var key=keyPrefix+value;var inited=cache[0][key]?!(seen=cache[0][key]):seen=cache[0][key]=[]}if(inited||indexOf(seen,value)<0){if(isLarge){seen.push(value)}var argsIndex=argsLength;while(--argsIndex){if(!(cache[argsIndex]||(cache[argsIndex]=cachedContains(args[argsIndex])))(value)){continue outer}}result.push(value)}}return result}function last(array,callback,thisArg){if(array){var n=0,length=array.length;if(typeof callback!="number"&&callback!=null){var index=length;callback=lodash.createCallback(callback,thisArg);while(index--&&callback(array[index],index,array)){n++}}else{n=callback;if(n==null||thisArg){return array[length-1]}}return slice(array,nativeMax(0,length-n))}}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;if(typeof fromIndex=="number"){index=(fromIndex<0?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1}while(index--){if(array[index]===value){return index}}return-1}function range(start,end,step){start=+start||0;step=+step||1;if(end==null){end=start;start=0}var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);while(++index<length){result[index]=start;start+=step}return result}function rest(array,callback,thisArg){if(typeof callback!="number"&&callback!=null){var n=0,index=-1,length=array?array.length:0;callback=lodash.createCallback(callback,thisArg);while(++index<length&&callback(array[index],index,array)){n++}}else{n=callback==null||thisArg?1:nativeMax(0,callback)}return slice(array,n)}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;callback=callback?lodash.createCallback(callback,thisArg,1):identity;value=callback(value);while(low<high){var mid=low+high>>>1;callback(array[mid])<value?low=mid+1:high=mid}return low}function union(array){if(!isArray(array)){arguments[0]=array?nativeSlice.call(array):arrayRef}return uniq(concat.apply(arrayRef,arguments))}function uniq(array,isSorted,callback,thisArg){var index=-1,length=array?array.length:0,result=[],seen=result;if(typeof isSorted!="boolean"&&isSorted!=null){thisArg=callback;callback=isSorted;isSorted=false}var isLarge=!isSorted&&length>=largeArraySize;if(isLarge){var cache={}}if(callback!=null){seen=[];callback=lodash.createCallback(callback,thisArg)}while(++index<length){var value=array[index],computed=callback?callback(value,index,array):value;if(isLarge){var key=keyPrefix+computed;var inited=cache[key]?!(seen=cache[key]):seen=cache[key]=[]}if(isSorted?!index||seen[seen.length-1]!==computed:inited||indexOf(seen,computed)<0){if(callback||isLarge){seen.push(computed)}result.push(value)}}return result}function unzip(array){var index=-1,length=array?array.length:0,tupleLength=length?max(pluck(array,"length")):0,result=Array(tupleLength);while(++index<length){var tupleIndex=-1,tuple=array[index];while(++tupleIndex<tupleLength){(result[tupleIndex]||(result[tupleIndex]=Array(length)))[index]=tuple[tupleIndex]}}return result}function without(array){return difference(array,nativeSlice.call(arguments,1))}function zip(array){var index=-1,length=array?max(pluck(arguments,"length")):0,result=Array(length);while(++index<length){result[index]=pluck(arguments,index)}return result}function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};while(++index<length){var key=keys[index];if(values){result[key]=values[index]}else{result[key[0]]=key[1]}}return result}function after(n,func){if(n<1){return func()}return function(){if(--n<1){return func.apply(this,arguments)}}}function bind(func,thisArg){return support.fastBind||nativeBind&&arguments.length>2?nativeBind.call.apply(nativeBind,arguments):createBound(func,thisArg,nativeSlice.call(arguments,2))}function bindAll(object){var funcs=arguments.length>1?concat.apply(arrayRef,nativeSlice.call(arguments,1)):functions(object),index=-1,length=funcs.length;while(++index<length){var key=funcs[index];object[key]=bind(object[key],object)}return object}function bindKey(object,key){return createBound(object,key,nativeSlice.call(arguments,2),indicatorObject)}function compose(){var funcs=arguments;return function(){var args=arguments,length=funcs.length;while(length--){args=[funcs[length].apply(this,args)]}return args[0]}}function createCallback(func,thisArg,argCount){if(func==null){return identity}var type=typeof func;if(type!="function"){if(type!="object"){return function(object){return object[func]}}var props=keys(func);return function(object){var length=props.length,result=false;while(length--){if(!(result=isEqual(object[props[length]],func[props[length]],indicatorObject))){break}}return result}}if(typeof thisArg!="undefined"){if(argCount===1){return function(value){return func.call(thisArg,value)}}if(argCount===2){return function(a,b){return func.call(thisArg,a,b)}}if(argCount===4){return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return function(value,index,collection){return func.call(thisArg,value,index,collection)}}return func}function debounce(func,wait,options){var args,result,thisArg,timeoutId,trailing=true;function delayed(){timeoutId=null;if(trailing){result=func.apply(thisArg,args)}}if(options===true){var leading=true;trailing=false}else if(options&&objectTypes[typeof options]){leading=options.leading;trailing="trailing"in options?options.trailing:trailing}return function(){var isLeading=leading&&!timeoutId;args=arguments;thisArg=this;clearTimeout(timeoutId);timeoutId=setTimeout(delayed,wait);if(isLeading){result=func.apply(thisArg,args)}return result}}function defer(func){var args=nativeSlice.call(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}if(isV8&&freeModule&&typeof setImmediate=="function"){defer=bind(setImmediate,context)}function delay(func,wait){var args=nativeSlice.call(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function memoize(func,resolver){var cache={};return function(){var key=keyPrefix+(resolver?resolver.apply(this,arguments):arguments[0]);return hasOwnProperty.call(cache,key)?cache[key]:cache[key]=func.apply(this,arguments)}}function once(func){var ran,result;return function(){if(ran){return result}ran=true;result=func.apply(this,arguments);func=null;return result}}function partial(func){return createBound(func,nativeSlice.call(arguments,1))}function partialRight(func){return createBound(func,nativeSlice.call(arguments,1),null,indicatorObject)}function throttle(func,wait,options){var args,result,thisArg,timeoutId,lastCalled=0,leading=true,trailing=true;function trailingCall(){lastCalled=new Date;timeoutId=null;if(trailing){result=func.apply(thisArg,args)}}if(options===false){leading=false}else if(options&&objectTypes[typeof options]){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}return function(){var now=new Date;if(!timeoutId&&!leading){lastCalled=now}var remaining=wait-(now-lastCalled);args=arguments;thisArg=this;if(remaining<=0){clearTimeout(timeoutId);timeoutId=null;lastCalled=now;result=func.apply(thisArg,args)}else if(!timeoutId){timeoutId=setTimeout(trailingCall,remaining)}return result}}function wrap(value,wrapper){return function(){var args=[value];push.apply(args,arguments);return wrapper.apply(this,args)}}function escape(string){return string==null?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=[value];push.apply(args,arguments);var result=func.apply(lodash,args);return value&&typeof value=="object"&&value==result?this:new lodashWrapper(result)}})}function noConflict(){context._=oldDash;return this}var parseInt=nativeParseInt("08")==8?nativeParseInt:function(value,radix){return nativeParseInt(isString(value)?value.replace(reLeadingZeros,""):value,radix||0)};function random(min,max){if(min==null&&max==null){max=1}min=+min||0;if(max==null){max=min;min=0}return min+floor(nativeRandom()*((+max||0)-min+1))}function result(object,property){var value=object?object[property]:undefined;return isFunction(value)?object[property]():value}function template(text,data,options){var settings=lodash.templateSettings;text||(text="");options=defaults({},options,settings);var imports=defaults({},options.imports,settings.imports),importsKeys=keys(imports),importsValues=values(imports);var isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");
text.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable,hasVariable=variable;if(!hasVariable){variable="obj";source="with ("+variable+") {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+variable+") {\n"+(hasVariable?"":variable+" || ("+variable+" = {});\n")+"var __t, __p = '', __e = _.escape"+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var sourceURL="\n/*\n//@ sourceURL="+(options.sourceURL||"/lodash/template/source["+templateCounter++ +"]")+"\n*/";try{var result=Function(importsKeys,"return "+source+sourceURL).apply(undefined,importsValues)}catch(e){e.source=source;throw e}if(data){return result(data)}result.source=source;return result}function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);callback=lodash.createCallback(callback,thisArg,1);while(++index<n){result[index]=callback(index)}return result}function unescape(string){return string==null?"":String(string).replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=++idCounter;return String(prefix==null?"":prefix)+id}function tap(value,interceptor){interceptor(value);return value}function wrapperToString(){return String(this.__wrapped__)}function wrapperValueOf(){return this.__wrapped__}lodash.after=after;lodash.assign=assign;lodash.at=at;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.compact=compact;lodash.compose=compose;lodash.countBy=countBy;lodash.createCallback=createCallback;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.filter=filter;lodash.flatten=flatten;lodash.forEach=forEach;lodash.forIn=forIn;lodash.forOwn=forOwn;lodash.functions=functions;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.invert=invert;lodash.invoke=invoke;lodash.keys=keys;lodash.map=map;lodash.max=max;lodash.memoize=memoize;lodash.merge=merge;lodash.min=min;lodash.omit=omit;lodash.once=once;lodash.pairs=pairs;lodash.partial=partial;lodash.partialRight=partialRight;lodash.pick=pick;lodash.pluck=pluck;lodash.range=range;lodash.reject=reject;lodash.rest=rest;lodash.shuffle=shuffle;lodash.sortBy=sortBy;lodash.tap=tap;lodash.throttle=throttle;lodash.times=times;lodash.toArray=toArray;lodash.union=union;lodash.uniq=uniq;lodash.unzip=unzip;lodash.values=values;lodash.where=where;lodash.without=without;lodash.wrap=wrap;lodash.zip=zip;lodash.zipObject=zipObject;lodash.collect=map;lodash.drop=rest;lodash.each=forEach;lodash.extend=assign;lodash.methods=functions;lodash.object=zipObject;lodash.select=filter;lodash.tail=rest;lodash.unique=uniq;mixin(lodash);lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.contains=contains;lodash.escape=escape;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.has=has;lodash.identity=identity;lodash.indexOf=indexOf;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isBoolean=isBoolean;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isNaN=isNaN;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isString=isString;lodash.isUndefined=isUndefined;lodash.lastIndexOf=lastIndexOf;lodash.mixin=mixin;lodash.noConflict=noConflict;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.result=result;lodash.runInContext=runInContext;lodash.size=size;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.template=template;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.all=every;lodash.any=some;lodash.detect=find;lodash.foldl=reduce;lodash.foldr=reduceRight;lodash.include=contains;lodash.inject=reduce;forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);return func.apply(lodash,args)}}});lodash.first=first;lodash.last=last;lodash.take=first;lodash.head=first;forOwn(lodash,function(func,methodName){if(!lodash.prototype[methodName]){lodash.prototype[methodName]=function(callback,thisArg){var result=func(this.__wrapped__,callback,thisArg);return callback==null||thisArg&&typeof callback!="function"?result:new lodashWrapper(result)}}});lodash.VERSION="1.2.0";lodash.prototype.toString=wrapperToString;lodash.prototype.value=wrapperValueOf;lodash.prototype.valueOf=wrapperValueOf;forEach(["join","pop","shift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return func.apply(this.__wrapped__,arguments)}});forEach(["push","reverse","sort","unshift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){func.apply(this.__wrapped__,arguments);return this}});forEach(["concat","slice","splice"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){return new lodashWrapper(func.apply(this.__wrapped__,arguments))}});return lodash}var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){window._=_;define(function(){return _})}else if(freeExports&&!freeExports.nodeType){if(freeModule){(freeModule.exports=_)._=_}else{freeExports._=_}}else{window._=_}}(this)}(window)},{}],60:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],56:[function(require,module,exports){!function(process){!function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.setImmediate=setImmediate;async.nextTick=setImmediate}else{async.setImmediate=async.nextTick;async.nextTick=function(fn){setTimeout(fn,0)}}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=setImmediate}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}}}))})};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;!function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}}()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null)}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){}}});_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.waterfall=function(tasks,callback){callback=callback||function(){};if(tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(test()){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(!test()){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback)},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key])}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else if(typeof module!=="undefined"&&module.exports){module.exports=async}else{root.async=async}}()}(require("__browserify_process"))},{__browserify_process:60}],2:[function(require,module,exports){var _=require("lodash"),serializer=new XMLSerializer,XML_NS="http://www.w3.org/XML/1998/namespace",TOP_LEVEL_LOOKUP={},LOOKUP={},LOOKUP_EXT={};var find=exports.find=function(xml,NS,selector){var children=xml.querySelectorAll(selector);return _.filter(children,function(child){return child.namespaceURI===NS&&child.parentNode==xml})};exports.init=function(self,xml,data){self.xml=xml||document.createElementNS(self.NS,self.EL);self.xml.setAttribute("xmlns",self.NS);self._extensions={};_.each(self.xml.childNodes,function(child){var childName=child.namespaceURI+"|"+child.localName;var ChildStanza=LOOKUP[childName];if(ChildStanza!==undefined){var name=ChildStanza.prototype._name;self._extensions[name]=new ChildStanza(null,child);self._extensions[name].parent=self}});_.extend(self,data);return self};exports.getSubText=function(xml,NS,element){var subs=find(xml,NS,element);if(!subs){return""}for(var i=0;i<subs.length;i++){if(subs[i].namespaceURI===NS){return subs[i].textContent||""}}return""};exports.getMultiSubText=function(xml,NS,element,extractor){var subs=find(xml,NS,element),results=[];extractor=extractor||function(sub){return sub.textContent||""};for(var i=0;i<subs.length;i++){if(subs[i].namespaceURI===NS){results.push(extractor(subs[i]))}}return results};exports.getSubLangText=function(xml,NS,element,defaultLang){var subs=find(xml,NS,element);if(!subs){return{}}var results={},langs=[],lang,sub;for(var i=0;i<subs.length;i++){sub=subs[i];if(sub.namespaceURI===NS){lang=sub.getAttributeNS(XML_NS,"lang")||defaultLang;langs.push(lang);results[lang]=sub.textContent||""}}return results};exports.setSubText=function(xml,NS,element,value){var subs=find(xml,NS,element);if(!subs.length){if(value){var sub=document.createElementNS(NS,element);sub.textContent=value;xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(subs[i].namespaceURI===NS){if(value){subs[i].textContent=value;return}else{xml.removeChild(subs[i])}}}}};exports.setMultiSubText=function(xml,NS,element,value,builder){var subs=find(xml,NS,element),values=[];builder=builder||function(value){var sub=document.createElementNS(NS,element);sub.textContent=value;xml.appendChild(sub)};if(typeof value==="string"){values=(value||"").split("\n")}else{values=value}_.forEach(subs,function(sub){xml.removeChild(sub)});_.forEach(values,function(val){if(val){builder(val)}})};exports.setSubLangText=function(xml,NS,element,value,defaultLang){var subs=find(xml,NS,element),sub,lang;if(subs.length){for(var i=0;i<subs.length;i++){sub=subs[i];if(sub.namespaceURI===NS){xml.removeChild(sub)}}}if(typeof value==="string"){sub=document.createElementNS(NS,element);sub.textContent=value;xml.appendChild(sub)}else if(typeof value==="object"){for(lang in value){if(value.hasOwnProperty(lang)){sub=document.createElementNS(NS,element);if(lang!==defaultLang){sub.setAttributeNS(XML_NS,"lang",lang)}sub.textContent=value[lang];xml.appendChild(sub)}}}};exports.getAttribute=function(xml,attr,defaultVal){return xml.getAttribute(attr)||defaultVal||""};exports.setAttribute=function(xml,attr,value){if(value){xml.setAttribute(attr,value)}else{xml.removeAttribute(attr)}};exports.getSubAttribute=function(xml,NS,sub,attr,defaultVal){var subs=find(xml,NS,sub);if(!subs){return""}for(var i=0;i<subs.length;i++){if(subs[i].namespaceURI===NS){return subs[i].getAttribute(attr)||defaultVal||""}}return""};exports.setSubAttribute=function(xml,NS,sub,attr,value){var subs=find(xml,NS,sub);if(!subs.length){if(value){sub=document.createElementNS(NS,sub);sub.setAttribute(attr,value);xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(subs[i].namespaceURI===NS){if(value){subs[i].setAttribute(attr,value);return}else{subs[i].removeAttribute(attr)}}}}};exports.toString=function(){return serializer.serializeToString(this.xml)};exports.toJSON=function(){var result={},exclude={constructor:true,NS:true,EL:true,toString:true,toJSON:true,_extensions:true,prototype:true,xml:true,parent:true,_name:true},prop;for(prop in this._extensions){if(this._extensions[prop].toJSON){result[prop]=this._extensions[prop].toJSON()}}for(prop in this){if(!exclude[prop]&&!LOOKUP_EXT[prop]&&!this._extensions[prop]&&prop[0]!=="_"){var val=this[prop];if(typeof val!="function"&&(typeof val=="object"&&Object.keys(val).length>0||!!val)){result[prop]=val}}}return result};exports.extend=function(ParentStanza,ChildStanza){var name=ChildStanza.prototype._name,qName=ChildStanza.prototype.NS+"|"+ChildStanza.prototype.EL;LOOKUP[qName]=ChildStanza;LOOKUP_EXT[name]=ChildStanza;ParentStanza.prototype.__defineGetter__(name,function(){if(!this._extensions[name]){var existing=exports.find(this.xml,ChildStanza.prototype.NS,ChildStanza.prototype.EL);if(!existing.length){this._extensions[name]=new ChildStanza;this.xml.appendChild(this._extensions[name].xml)}else{this._extensions[name]=new ChildStanza(null,existing[0])}this._extensions[name].parent=this}return this._extensions[name]});ParentStanza.prototype.__defineSetter__(name,function(value){var child=this[name];_.extend(child,value)})};exports.topLevel=function(Stanza){var name=Stanza.prototype.NS+"|"+Stanza.prototype.EL;LOOKUP[name]=Stanza;TOP_LEVEL_LOOKUP[name]=Stanza};exports.build=function(xml){var Stanza=TOP_LEVEL_LOOKUP[xml.namespaceURI+"|"+xml.localName];if(Stanza){return new Stanza(null,xml)}};exports.XML_NS=XML_NS;exports.TOP_LEVEL_LOOKUP=TOP_LEVEL_LOOKUP;exports.LOOKUP_EXT=LOOKUP_EXT;exports.LOOKUP=LOOKUP},{lodash:54}],4:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza");function Message(data,xml){return stanza.init(this,xml,data)}Message.prototype={constructor:{value:Message},_name:"message",NS:"jabber:client",EL:"message",toString:stanza.toString,toJSON:stanza.toJSON,get lang(){return this.xml.getAttributeNS(stanza.XML_NS,"lang")||""},set lang(value){this.xml.setAttributeNS(stanza.XML_NS,"lang",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)},get to(){return this.xml.getAttribute("to")||""},set to(value){this.xml.setAttribute("to",value)},get from(){return this.xml.getAttribute("from")||""},set from(value){this.xml.setAttribute("from",value)},get type(){return this.xml.getAttribute("type")||"normal"},set type(value){this.xml.setAttribute("type",value)},get body(){var bodies=this.$body;return bodies[this.lang]||""},get $body(){return stanza.getSubLangText(this.xml,this.NS,"body",this.lang)},set body(value){stanza.setSubLangText(this.xml,this.NS,"body",value,this.lang)},get thread(){return stanza.getSubText(this.xml,this.NS,"thread")},set thread(value){stanza.setSubText(this.xml,this.NS,"thread",value)},get parentThread(){var threads=stanza.find(this.xml,this.NS,"thread");if(!threads.length){return""}return threads[0].getAttribute("parent")||""},set parentThread(value){var threads=stanza.find(this.xml,this.NS,"thread");if(!threads.length){if(!value){return}var thread=document.createElementNS(this.NS,"thread");thread.setAttribute("parent",value);this.xml.appendChild(thread)}else{if(value){threads[0].setAttribute("parent",value)}else{threads[0].removeAttribute("parent")}}}};stanza.topLevel(Message);module.exports=Message},{"./stanza":2,lodash:54}],5:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza");function Presence(data,xml){return stanza.init(this,xml,data)}Presence.prototype={constructor:{value:Presence},_name:"presence",NS:"jabber:client",EL:"presence",toString:stanza.toString,toJSON:stanza.toJSON,get lang(){return this.xml.getAttributeNS(stanza.XML_NS,"lang")||""},set lang(value){this.xml.setAttributeNS(stanza.XML_NS,"lang",value)},get id(){return this.xml.getAttribute("id")||""},set id(value){this.xml.setAttribute("id",value)},get to(){return this.xml.getAttribute("to")||""},set to(value){this.xml.setAttribute("to",value)},get from(){return this.xml.getAttribute("from")||""},set from(value){this.xml.setAttribute("from",value)},get type(){return this.xml.getAttribute("type")||""},set type(value){this.xml.setAttribute("type",value)},get status(){var statuses=this.$status;return statuses[this.lang]||""},get $status(){return stanza.getSubLangText(this.xml,this.NS,"status",this.lang)},set status(value){stanza.setSubLangText(this.xml,this.NS,"status",value,this.lang)},get priority(){return stanza.getSubText(this.xml,this.NS,"priority")},set priority(value){stanza.setSubText(this.xml,this.NS,"priority",value)},get show(){return stanza.getSubText(this.xml,this.NS,"show")},set show(value){stanza.setSubText(this.xml,this.NS,"show",value)}};stanza.topLevel(Presence);module.exports=Presence},{"./stanza":2,lodash:54}],7:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Message=require("./message");function SOX(data,xml){return stanza.init(this,xml,data)}SOX.prototype={constructor:{value:SOX},_name:"sox",NS:"http://stanza.io/protocol/sox",EL:"sox",toString:stanza.toString,toJSON:stanza.toJSON,get type(){return stanza.getAttribute(this.xml,"type")},set type(value){stanza.setAttribute(this.xml,"type",value)},get label(){return stanza.getAttribute(this.xml,"label")},set label(value){stanza.setAttribute(this.xml,"label",value)},get id(){return stanza.getAttribute(this.xml,"id")},set id(value){stanza.setAttribute(this.xml,"id",value)},get sid(){return stanza.getAttribute(this.xml,"sid")},set sid(value){stanza.setAttribute(this.xml,"sid",value)},get sdp(){return this.xml.textContent},set sdp(value){this.xml.textContent=value}};stanza.extend(Message,SOX);module.exports=SOX},{"./stanza":2,"./message":4,lodash:54}],8:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Iq=require("./iq");function Jingle(data,xml){return stanza.init(this,xml,data)}Jingle.prototype={constructor:{value:Jingle},_name:"jingle",NS:"urn:xmpp:jingle:1",EL:"jingle",toString:stanza.toString,toJSON:stanza.toJSON,get action(){return stanza.getAttribute(this.xml,"action")
},set action(value){stanza.setAttribute(this.xml,"action",value)},get initiator(){return stanza.getAttribute(this.xml,"initiator")},set initiator(value){stanza.setAttribute(this.xml,"initiator",value)},get responder(){return stanza.getAttribute(this.xml,"responder")},set responder(value){stanza.setAttribute(this.xml,"responder",value)},get sid(){return stanza.getAttribute(this.xml,"sid")},set sid(value){stanza.setAttribute(this.xml,"sid",value)},get contents(){var contents=stanza.find(this.xml,"urn:xmpp:jingle:1","content"),results=[];_.forEach(contents,function(xml){results.push(new Content({},xml).toJSON())});return results},set contents(value){var self=this;_.forEach(value,function(data){var content=new Content(data);self.xml.appendChild(content.xml)})}};function Content(data,xml){return stanza.init(this,xml,data)}Content.prototype={constructor:{value:Content},_name:"jingleContent",NS:"urn:xmpp:jingle:1",EL:"content",toString:stanza.toString,toJSON:stanza.toJSON,get creator(){return stanza.getAttribute(this.xml,"creator")},set creator(value){stanza.setAttribute(this.xml,"creator",value)},get disposition(){return stanza.getAttribute(this.xml,"disposition","session")},set disposition(value){stanza.setAttribute(this.xml,"disposition",value)},get name(){return stanza.getAttribute(this.xml,"name")},set name(value){stanza.setAttribute(this.xml,"name",value)},get senders(){return stanza.getAttribute(this.xml,"senders","both")},set senders(value){stanza.setAttribute(this.xml,"senders",value)}};stanza.extend(Iq,Jingle);exports.Jingle=Jingle;exports.Content=Content},{"./stanza":2,"./iq":6,lodash:54}],9:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),jingle=require("./jingle");function RTP(data,xml){return stanza.init(this,xml,data)}RTP.prototype={constructor:{value:RTP},_name:"rtp",NS:"urn:xmpp:jingle:apps:rtp:1",EL:"description",toString:stanza.toString,toJSON:stanza.toJSON,get media(){return stanza.getAttribute(this.xml,"media")},set media(value){stanza.setAttribute(this.xml,"media",value)},get ssrc(){return stanza.getAttribute(this.xml,"ssrc")},set ssrc(value){stanza.setAttribute(this.xml,"ssrc",value)},get bandwidth(){return stanza.getSubText(this.xml,this.NS,"bandwidth")},set bandwidth(value){stanza.setSubText(this.xml,this.NS,"bandwidth",value)},get bandwidthType(){return stanza.getSubAttribute(this.xml,this.NS,"bandwidth","type")},set bandwidthType(value){stanza.setSubAttribute(this.xml,this.NS,"bandwidth","type",value)},get payloadTypes(){var payloadTypes=stanza.find(this.xml,"urn:xmpp:jingle:apps:rtp:1","payload-type"),results=[];_.forEach(payloadTypes,function(xml){results.push(new PayloadType({},xml).toJSON())});return results},set payloadTypes(value){var self=this;_.forEach(value,function(data){var payloadType=new PayloadType(data);self.xml.appendChild(payloadType.xml)})},get cryptoRequired(){var req=stanza.getSubAttribute(this.xml,this.NS,"encryption","required");return req==="true"||req==="1"},set cryptoRequired(value){stanza.setSubAttribute(this.xml,this.NS,"encryption","required",value?"true":"false")},get crypto(){var encryption=stanza.find(this.xml,this.NS,"encryption"),results=[];if(encryption){var encryptionOptions=stanza.find(encryption,this.NS,"crypto");_.forEach(encryptionOptions,function(xml){results.push(new Crypto({},xml).toJSON())})}return results},set crypto(value){var self=this,encryption=stanza.find(this.xml,this.NS,"encryption");if(!encryption){encryption=document.createElementNS(this.NS,"encryption")}_.forEach(value,function(data){var crypto=new Crypto(data);encryption.appendChild(crypto.xml)})}};function Crypto(data,xml){return stanza.init(this,xml,data)}Crypto.prototype={constructor:{value:Crypto},_name:"_crypto",NS:"urn:xmpp:jingle:apps:rtp:1",EL:"crypto",toString:stanza.toString,toJSON:stanza.toJSON,get cipherSuite(){return stanza.getAttribute(this.xml,"cipher-suite")},set cipherSuite(value){stanza.setAttribute(this.xml,"cipher-suite",value)},get keyParams(){return stanza.getAttribute(this.xml,"key-params")},set keyParams(value){stanza.setAttribute(this.xml,"key-params",value)},get sessionParams(){return stanza.getAttribute(this.xml,"session-params")},set sessionParams(value){stanza.setAttribute(this.xml,"session-params",value)},get tag(){return stanza.getAttribute(this.xml,"tag")},set tag(value){stanza.setAttribute(this.xml,"tag",value)}};function PayloadType(data,xml){return stanza.init(this,xml,data)}PayloadType.prototype={constructor:{value:PayloadType},_name:"payloadType",NS:"urn:xmpp:jingle:apps:rtp:1",EL:"payload-type",toString:stanza.toString,toJSON:stanza.toJSON,get channels(){return stanza.getAttribute(this.xml,"channels")},set channels(value){stanza.setAttribute(this.xml,"channels",value)},get clockrate(){return stanza.getAttribute(this.xml,"clockrate")},set clockrate(value){stanza.setAttribute(this.xml,"clockrate",value)},get id(){return stanza.getAttribute(this.xml,"id")},set id(value){stanza.setAttribute(this.xml,"id",value)},get maxptime(){return stanza.getAttribute(this.xml,"maxptime")},set maxptime(value){stanza.setAttribute(this.xml,"maxptime",value)},get name(){return stanza.getAttribute(this.xml,"name")},set name(value){stanza.setAttribute(this.xml,"name",value)},get ptime(){return stanza.getAttribute(this.xml,"ptime")},set ptime(value){stanza.setAttribute(this.xml,"ptime",value)},get parameters(){var result={};var params=stanza.find(this.xml,this.NS,"parameter");_.forEach(params,function(param){var key=stanza.getAttribute(param,"name"),value=stanza.getAttribute(param,"value");result[key]=value});return result},set parameters(value){var self=this;_.forEach(value,function(key,value){var param=document.createElementNS(self.NS,"parameter");param.setAttribute("name",key);param.setAttribute("value",value);self.xml.appendChild(param)})}};stanza.extend(jingle.Content,RTP);exports.RTP=RTP;exports.Crypto=Crypto;exports.PayloadType=PayloadType},{"./stanza":2,"./jingle":8,lodash:54}],10:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),jingle=require("./jingle");function ICEUDP(data,xml){return stanza.init(this,xml,data)}ICEUDP.prototype={constructor:{value:ICEUDP},_name:"iceUdp",NS:"urn:xmpp:jingle:transports:ice-udp:1",EL:"transport",toString:stanza.toString,toJSON:stanza.toJSON,get pwd(){return stanza.getAttribute(this.xml,"pwd")},set pwd(value){stanza.setAttribute(this.xml,"pwd",value)},get ufrag(){return stanza.getAttribute(this.xml,"ufrag")},set ufrag(value){stanza.setAttribute(this.xml,"ufrag",value)},get candidates(){var candidates=stanza.find(this.xml,"urn:xmpp:jingle:transports:ice-udp:1","candidate"),results=[];_.forEach(candidates,function(xml){results.push(new Candidate({},xml).toJSON())});return results},set candidates(value){var self=this;_.forEach(value,function(data){var candidate=new Candidate(data);self.xml.appendChild(candidate.xml)})},get remoteCandidate(){return{component:stanza.getSubAttribute(this.xml,this.NS,"remote-candidate","component"),ip:stanza.getSubAttribute(this.xml,this.NS,"remote-candidate","ip"),port:stanza.getSubAttribute(this.xml,this.NS,"remote-candidate","port")}},set remoteCandidate(value){stanza.setSubAttribute(this.xml,this.NS,"remote-candidate","component",value.component);stanza.setSubAttribute(this.xml,this.NS,"remote-candidate","ip",value.ip);stanza.setSubAttribute(this.xml,this.NS,"remote-candidate","port",value.port)}};function Candidate(data,xml){return stanza.init(this,xml,data)}Candidate.prototype={constructor:{value:Candidate},_name:"iceUdpCandidate",NS:"urn:xmpp:jingle:transports:ice-udp:1",EL:"candidate",toString:stanza.toString,toJSON:stanza.toJSON,get component(){return stanza.getAttribute(this.xml,"component")},set component(value){stanza.setAttribute(this.xml,"component",value)},get foundation(){return stanza.getAttribute(this.xml,"foundation")},set foundation(value){stanza.setAttribute(this.xml,"foundation",value)},get generation(){return stanza.getAttribute(this.xml,"generation")},set generation(value){stanza.setAttribute(this.xml,"generation",value)},get id(){return stanza.getAttribute(this.xml,"id")},set id(value){stanza.setAttribute(this.xml,"id",value)},get ip(){return stanza.getAttribute(this.xml,"ip")},set ip(value){stanza.setAttribute(this.xml,"ip",value)},get network(){return stanza.getAttribute(this.xml,"network")},set network(value){stanza.setAttribute(this.xml,"network",value)},get port(){return stanza.getAttribute(this.xml,"port")},set port(value){stanza.setAttribute(this.xml,"port",value)},get priority(){return stanza.getAttribute(this.xml,"priority")},set priority(value){stanza.setAttribute(this.xml,"priority",value)},get protocol(){return stanza.getAttribute(this.xml,"protocol")},set protocol(value){stanza.setAttribute(this.xml,"protocol",value)},get relAddr(){return stanza.getAttribute(this.xml,"relAddr")},set relAddr(value){stanza.setAttribute(this.xml,"relAddr",value)},get relPort(){return stanza.getAttribute(this.xml,"relPort")},set relPort(value){stanza.setAttribute(this.xml,"relPort",value)},get type(){return stanza.getAttribute(this.xml,"type")},set type(value){stanza.setAttribute(this.xml,"type",value)}};function Fingerprint(data,xml){return stanza.init(this,xml,data)}Fingerprint.prototype={constructor:{value:Fingerprint},_name:"fingerprint",NS:"urn:xmpp:tmp:jingle:apps:dtls:0",EL:"fingerprint",toString:stanza.toString,toJSON:stanza.toJSON,get hash(){return stanza.getAttribute(this.xml,"hash")},set hash(value){stanza.setAttribute(this.xml,"hash",value)},get required(){var req=stanza.getAttribute(this.xml,"required");return req==="1"||req==="true"},set required(value){if(value||value!=="0"&&value!=="false"){stanza.setAttribute(this.xml,"required","1")}}};stanza.extend(jingle.Content,ICEUDP);stanza.extend(ICEUDP,Fingerprint);exports.ICEUDP=ICEUDP;exports.Candidate=Candidate},{"./stanza":2,"./jingle":8,lodash:54}],12:[function(require,module,exports){!function(){var _=require("lodash"),crypto=require("crypto");require("../stanza/disco");require("../stanza/caps");var UTF8={encode:function(s){return unescape(encodeURIComponent(s))},decode:function(s){return decodeURIComponent(escape(s))}};function verifyVerString(info,hash,check){if(hash==="sha-1"){hash="sha1"}var computed=this._generatedVerString(info,hash);return computed&&computed==check}function generateVerString(info,hash){var S="",features=info.features.sort(),identities=[],formTypes={},formOrder=[];_.forEach(info.identities,function(identity){identities.push([identity.category||"",identity.type||"",identity.lang||"",identity.name||""].join("/"))});var idLen=identities.length,featureLen=features.length;identities=_.unique(identities,true);features=_.unique(features,true);if(featureLen!=features.length||idLen!=identities.length){return false}S+=identities.join("<")+"<";S+=features.join("<")+"<";var illFormed=false;_.forEach(info.extensions,function(ext){var fields=ext.fields;for(var i=0,len=fields.length;i<len;i++){if(fields[i].name=="FORM_TYPE"&&fields[i].type=="hidden"){var name=fields[i].value;if(formTypes[name]){illFormed=true;return}formTypes[name]=ext;formOrder.push(name);return}}});if(illFormed){return false}formOrder.sort();_.forEach(formOrder,function(name){var ext=formTypes[name],fields={},fieldOrder=[];S+="<"+name;_.forEach(ext.fields,function(field){var fieldName=field.name;if(fieldName!="FORM_TYPE"){var values=field.value||"";if(typeof values!="object"){values=values.split("\n")}fields[fieldName]=values.sort();fieldOrder.push(fieldName)}});fieldOrder.sort();_.forEach(fieldOrder,function(fieldName){S+="<"+fieldName;_.forEach(fields[fieldName],function(val){S+="<"+val})})});if(hash==="sha-1"){hash="sha1"}var ver=crypto.createHash(hash).update(UTF8.encode(S)).digest(),padding=4-ver.length%4;for(var i=0;i<padding;i++){ver+="="}return ver}function Disco(client){this.features={};this.identities={};this.extensions={};this.items={};this.caps={}}Disco.prototype={constructor:{value:Disco},addFeature:function(node,feature){node=node||"";if(!this.features[node]){this.features[node]=[]}this.features[node].push(feature)},addIdentity:function(node,identity){node=node||"";if(!this.identities[node]){this.identities[node]=[]}this.identities[node].push(identity)},addItem:function(node,item){node=node||"";if(!this.items[node]){this.items[node]=[]}this.items[node].push(item)},addExtension:function(node,form){node=node||"";if(!this.extensions[node]){this.extensions[node]=[]}this.extensions[node].push(form)}};module.exports=function(client){client.disco=new Disco(client);client.disco.addFeature("","http://jabber.org/protocol/disco#info");client.disco.addIdentity("",{category:"client",type:"web"});client.getDiscoInfo=function(jid,node,cb){this.sendIq({to:jid,type:"get",discoInfo:{node:node}},cb)};client.getDiscoItems=function(jid,node,cb){this.sendIq({to:jid,type:"get",discoItems:{node:node}},cb)};client.updateCaps=function(){this.disco.caps={node:this.config.capsNode||"https://stanza.io",hash:"sha-1",ver:generateVerString({identities:this.disco.identities[""],features:this.disco.features[""],extensions:this.disco.extensions[""]},"sha-1")}};client.on("iq:get:discoInfo",function(iq){var node=iq.discoInfo.node,reportedNode=iq.discoInfo.node;if(node===client.disco.caps.node+"#"+client.disco.caps.ver){reportedNode=node;node=""}client.sendIq(iq.resultReply({discoInfo:{node:reportedNode,identities:client.disco.identities[node]||[],features:client.disco.features[node]||[],extensions:client.disco.extensions[node]||[]}}))});client.on("iq:get:discoItems",function(iq){var node=iq.discoInfo.node;client.sendIq(iq.resultReply({discoItems:{node:node,items:client.disco.items[node]||[]}}))})}}()},{crypto:40,"../stanza/disco":61,"../stanza/caps":57,lodash:54}],26:[function(require,module,exports){var uuid=require("node-uuid");var RTCPeerConnection=null,RTCSessionDescription=null,RTCIceCandidate=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,browser=null,webRTCSupport=true;if(navigator.mozGetUserMedia){browser="firefox";RTCPeerConnection=window.mozRTCPeerConnection;RTCSessionDescription=window.mozRTCSessionDescription;RTCIceCandidate=window.mozRTCIceCandidate;getUserMedia=navigator.mozGetUserMedia.bind(navigator);attachMediaStream=function(element,stream){element.mozSrcObject=stream;element.play()};reattachMediaStream=function(to,from){to.mozSrcObject=from.mozSrcObject;to.play()};MediaStream.prototype.getVideoTracks=function(){return[]};MediaStream.prototype.getAudioTracks=function(){return[]}}else if(navigator.webkitGetUserMedia){browser="chrome";RTCPeerConnection=window.webkitRTCPeerConnection;getUserMedia=navigator.webkitGetUserMedia.bind(navigator);attachMediaStream=function(element,stream){element.autoplay=true;element.src=webkitURL.createObjectURL(stream)};reattachMediaStream=function(to,from){to.src=from.src};if(!webkitMediaStream.prototype.getVideoTracks){webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks};webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}}if(!window.webkitRTCPeerConnection.prototype.getLocalStreams){window.webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams};window.webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams}}}else{webRTCSupport=false}function WebRTC(client){var self=this;this.client=client;this.peerConnectionConfig={iceServers:browser=="firefox"?[{url:"stun:124.124.124.2"}]:[{url:"stun:stun.l.google.com:19302"}]};this.peerConnectionConstraints={optional:[{DtlsSrtpKeyAgreement:true}]};this.media={audio:true,video:{mandatory:{},optional:[]}};this.sessions={};this.peerSessions={};this.attachMediaStream=attachMediaStream;if(!webRTCSupport){client.emit("webrtc:unsupported");return self}else{client.emit("webrtc:supported");client.disco.addFeature("","http://stanza.io/protocol/sox");client.on("message",function(msg){if(msg.type!=="error"&&msg._extensions.sox){var fullId=msg.from+":"+msg.sox.sid,session;if(msg.sox.type==="offer"){console.log("got an offer");session=new Peer(client,msg.from,msg.sox.sid);self.sessions[fullId]=session;if(!self.peerSessions[msg.from]){self.peerSessions[msg.from]=[]}self.peerSessions[msg.from].push(fullId)}else if(msg.sox.type==="answer"){console.log("got an answer");session=self.sessions[fullId];if(session){console.log("Setting remote description");session.conn.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:msg.sox.sdp}))}}else if(msg.sox.type==="candidate"){session=self.sessions[fullId];if(session){console.log("Adding new ICE candidate");session.conn.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:msg.sox.label,candidate:msg.sox.sdp}))}}client.emit("webrtc:"+msg.sox.type,msg)}})}}WebRTC.prototype={constructor:{value:WebRTC},testReadiness:function(){var self=this;if(this.localStream&&this.client.sessionStarted){setTimeout(function(){self.client.emit("webrtc:ready")},1e3)}},startLocalMedia:function(element){var self=this;getUserMedia(this.media,function(stream){attachMediaStream(element,stream);self.localStream=stream;self.testReadiness()},function(){throw new Error("Failed to get access to local media.")})},offerSession:function(peer){var self=this,sid=uuid.v4(),session=new Peer(this.client,peer,sid);this.sessions[peer+":"+sid]=session;if(!this.peerSessions[peer]){this.peerSessions[peer]=[]}this.peerSessions[peer].push(peer+":"+sid);session.conn.createOffer(function(sdp){console.log("Setting local description");session.conn.setLocalDescription(sdp);console.log("Sending offer");self.client.sendMessage({to:peer,sox:{type:"offer",sid:sid,sdp:sdp.sdp}})},null,this.mediaConstraints)},acceptSession:function(offerMsg){var self=this;var session=self.sessions[offerMsg.from+":"+offerMsg.sox.sid];if(session){console.log("Setting remote description");session.conn.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:offerMsg.sox.sdp}));session.conn.createAnswer(function(sdp){console.log("Setting local description");session.conn.setLocalDescription(sdp);console.log("Sending answer");self.client.sendMessage({to:session.jid,sox:{type:"answer",sid:session.sid,sdp:sdp.sdp}})},null,this.mediaConstraints)}},declineSession:function(offerMsg){this.endSession(offerMsg.from,offerMsg.sox.sid)},endSession:function(peer,sid){var session=this.sessions[peer+":"+sid];if(session){var fullId=peer+":"+sid,index=this.peerSessions[peer].indexOf(fullId);if(index!=-1){this.peerSessions.splice(index,1)}this.sessions[fullId]=undefined;session.conn.close();this.client.emit("webrtc:stream:removed",{sid:session.sid,peer:session.jid});this.client.sendMessage({to:peer,sox:{type:"end",sid:sid}})}},mute:function(){this._audioEnabled(false);this.client.emit("webrtc:audio:off")},unmute:function(){this._audioEnabled(true);this.client.emit("webrtc:audio:on")},pauseVideo:function(){this._videoEnabled(false);this.client.emit("webrtc:video:off")},resumeVideo:function(){this._videoEnabled(true);this.client.emit("webrtc:video:on")},pause:function(){this.mute();this.pauseVideo()},resume:function(){this.unmute();this.resumeVideo()},_audioEnabled:function(bool){this.localStream.getAudioTracks().forEach(function(track){track.enabled=!!bool})},_videoEnabled:function(bool){this.localStream.getVideoTracks().forEach(function(track){track.enabled=!!bool})}};function Peer(client,jid,sid){var self=this;this.client=client;this.jid=jid;this.sid=sid;this.closed=false;this.conn=new RTCPeerConnection(client.webrtc.peerConnectionConfig,client.webrtc.peerConnectionConstraints);this.conn.addStream(client.webrtc.localStream);this.conn.onicecandidate=function(event){if(self.closed)return;if(event.candidate){console.log("Sending candidate");self.client.sendMessage({mto:self.jid,sox:{type:"candidate",sid:self.sid,label:event.candidate.sdpMLineIndex,id:event.candidate.sdpMid,sdp:event.candidate.candidate}})}else{console.log("End of ICE candidates")}};this.conn.onaddstream=function(event){self.client.emit("webrtc:stream:added",{stream:event.stream,sid:self.sid,peer:self.jid})};this.conn.onremovestream=function(event){self.client.emit("webrtc:stream:removed",{sid:self.sid,peer:self.jid})};this.mediaConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}}}Peer.prototype={constructor:{value:Peer}};module.exports=function(client){client.webrtc=new WebRTC(client)}},{"node-uuid":55}],62:[function(require,module,exports){!function(){var SM=require("./stanza/sm"),MAX_SEQ=Math.pow(2,32);function mod(v,n){return(v%n+n)%n}function StreamManagement(conn){this.conn=conn;this.id=false;this.allowResume=true;this.started=false;this.lastAck=0;this.handled=0;this.windowSize=1;this.windowCount=0;this.unacked=[]}StreamManagement.prototype={constructor:{value:StreamManagement},enable:function(){var enable=new SM.Enable;enable.resume=this.allowResume;this.conn.send(enable);this.handled=0;this.started=true},resume:function(){var resume=new SM.Resume({h:this.handled,previd:this.id});this.conn.send(resume);this.started=true},enabled:function(resp){this.id=resp.id},resumed:function(resp){this.id=resp.id;if(resp.h){this.process(resp,true)}},failed:function(resp){this.started=false;this.id=false;this.lastAck=0;this.handled=0;this.windowCount=0;this.unacked=[]},ack:function(){this.conn.send(new SM.Ack({h:this.handled}))},request:function(){this.conn.send(new SM.Request)},process:function(ack,resend){var self=this,numAcked=mod(ack.h-this.lastAck,MAX_SEQ);for(var i=0;i<numAcked&&this.unacked.length>0;i++){this.conn.emit("stanza:acked",this.unacked.shift())}if(resend){var resendUnacked=this.unacked;this.unacked=[];resendUnacked.forEach(function(stanza){self.conn.send(stanza)})}this.lastAck=ack.h},track:function(stanza){var name=stanza._name,acceptable={message:true,presence:true,iq:true};if(this.started&&acceptable[name]){this.unacked.push(stanza);this.windowCount+=1;if(this.windowCount==this.windowSize){this.request();this.windowCount=0}}},handle:function(stanza){if(this.started){this.handled=mod(this.handled+1,MAX_SEQ)}}};module.exports=StreamManagement}()},{"./stanza/sm":46}],45:[function(require,module,exports){var WildEmitter=require("wildemitter"),_=require("lodash"),async=require("async"),stanza=require("./stanza/stanza"),Stream=require("./stanza/stream"),Message=require("./stanza/message"),Presence=require("./stanza/presence"),Iq=require("./stanza/iq"),StreamManagement=require("./sm"),uuid=require("node-uuid");function WSConnection(){var self=this;WildEmitter.call(this);self.sm=new StreamManagement(self);self.sendQueue=async.queue(function(data,cb){if(self.conn){self.emit("raw:outgoing",data);self.sm.track(data);if(typeof data!=="string"){data=data.toString()}self.conn.send(data)}cb()},1);function wrap(data){var result=[self.streamStart,data,self.streamEnd].join("");return result}function parse(data){return self.parser.parseFromString(data,"application/xml").childNodes[0]}self.on("connected",function(){self.send(["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(self.config.version||"1.0")+'"','xml:lang="'+(self.config.lang||"en")+'"','to="'+self.config.server+'">'].join(" "))});self.on("raw:incoming",function(data){var streamData,ended;data=data.trim();data=data.replace(/^(\s*<\?.*\?>\s*)*/,"");if(data.match(self.streamEnd)){return self.disconnect()}else if(self.hasStream){try{streamData=new Stream({},parse(wrap(data)))}catch(e){return self.disconnect()}}else{var parts=data.match(/^<(\S+:)?(\S+) /);self.streamStart=data;self.streamEnd="</"+(parts[1]||"")+parts[2]+">";ended=false;try{streamData=new Stream({},parse(data+self.streamEnd))}catch(e){try{streamData=new Stream({},parse(data));ended=true}catch(e2){return self.disconnect()}}self.hasStream=true;self.stream=streamData;self.emit("stream:start",streamData)}_.each(streamData._extensions,function(stanzaObj){if(!stanzaObj.lang){stanzaObj.lang=self.stream.lang}if(stanzaObj._name==="message"||stanzaObj._name==="presence"||stanzaObj._name==="iq"){self.sm.handle(stanzaObj);self.emit("stanza",stanzaObj)}self.emit(stanzaObj._eventname||stanzaObj._name,stanzaObj);self.emit("stream:data",stanzaObj);if(stanzaObj.id){self.emit("id:"+stanzaObj.id,stanzaObj)}});if(ended){self.emit("stream:end")}})}WSConnection.prototype=Object.create(WildEmitter.prototype,{constructor:{value:WSConnection}});WSConnection.prototype.connect=function(opts){var self=this;self.config=opts;self.hasStream=false;self.streamStart='<stream:stream xmlns:stream="http://etherx.jabber.org/streams">';self.streamEnd="</stream:stream>";self.parser=new DOMParser;self.serializer=new XMLSerializer;self.conn=new WebSocket(opts.wsURL,"xmpp");self.conn.onopen=function(){self.emit("connected",self)};self.conn.onclose=function(){self.emit("disconnected",self)};self.conn.onmessage=function(wsMsg){self.emit("raw:incoming",wsMsg.data)}};WSConnection.prototype.disconnect=function(){if(this.conn){if(this.hasStream){this.conn.send("</stream:stream>");this.emit("raw:outgoing","</stream:stream>");this.emit("stream:end")}this.hasStream=false;this.conn.close();this.stream=undefined;this.conn=undefined}};WSConnection.prototype.restart=function(){var self=this;self.hasStream=false;self.send(["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(self.config.version||"1.0")+'"','xml:lang="'+(self.config.lang||"en")+'"','to="'+self.config.server+'">'].join(" "))};WSConnection.prototype.send=function(data){this.sendQueue.push(data)};module.exports=WSConnection},{"./stanza/stanza":2,"./stanza/stream":3,"./stanza/message":4,"./stanza/presence":5,"./stanza/iq":6,"./sm":62,wildemitter:53,lodash:54,"node-uuid":55,async:56}],58:[function(require,module,exports){var stanza=require("./stanza");function RSM(data,xml){return stanza.init(this,xml,data)}RSM.prototype={constructor:{value:RSM},NS:"http://jabber.org/protocol/rsm",EL:"set",_name:"rsm",toString:stanza.toString,toJSON:stanza.toJSON,get after(){return stanza.getSubText(this.xml,this.NS,"after")},set after(value){stanza.setSubText(this.xml,this.NS,"after",value)},get before(){return stanza.getSubText(this.xml,this.NS,"before")},set before(value){stanza.setSubText(this.xml,this.NS,"before",value)},get count(){return parseInt(stanza.getSubText(this.xml,this.NS,"count")||"0",10)},set count(value){stanza.setSubText(this.xml,this.NS,"count",value.toString())},get first(){return stanza.getSubText(this.xml,this.NS,"first")},set first(value){stanza.setSubText(this.xml,this.NS,"first",value)},get firstIndex(){return stanza.getSubAttribute(this.xml,this.NS,"first","index")},set firstIndex(value){stanza.setSubAttribute(this.xml,this.NS,"first","index",value)},get index(){return stanza.getSubText(this.xml,this.NS,"index")},set index(value){stanza.setSubText(this.xml,this.NS,"index",value)},get last(){return stanza.getSubText(this.xml,this.NS,"last")},set last(value){stanza.setSubText(this.xml,this.NS,"last",value)},get max(){return stanza.getSubText(this.xml,this.NS,"max")},set max(value){stanza.setSubText(this.xml,this.NS,"max",value.toString())}};module.exports=RSM},{"./stanza":2}],44:[function(require,module,exports){var stanza=require("./stanza"),_=require("lodash"),StreamFeatures=require("./streamFeatures");function Mechanisms(data,xml){return stanza.init(this,xml,data)}Mechanisms.prototype={constructor:{value:Mechanisms},_name:"sasl",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"mechanisms",toString:stanza.toString,toJSON:stanza.toJSON,required:true,get mechanisms(){var result=[];var mechs=stanza.find(this.xml,this.NS,"mechanism");if(mechs.length){_.each(mechs,function(mech){result.push(mech.textContent)})}return result},set mechanisms(value){var self=this;var mechs=stanza.find(this.xml,this.NS,"mechanism");if(mechs.length){_.each(mechs,function(mech){self.xml.remove(mech)})}_.each(value,function(name){var mech=document.createElementNS(self.NS,"mechanism");mech.textContent=name;self.xml.appendChild(mech)})}};function Auth(data,xml){return stanza.init(this,xml,data)}Auth.prototype={constructor:{value:Auth},_name:"saslAuth",_eventname:"sasl:auth",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"auth",toString:stanza.toString,toJSON:stanza.toJSON,get value(){return atob(this.xml.textContent)},set value(value){this.xml.textContent=btoa(value)||"="},get mechanism(){return this.xml.getAttribute("mechanism")||""},set mechanism(value){this.xml.setAttribute("mechanism",value)}};function Challenge(data,xml){return stanza.init(this,xml,data)}Challenge.prototype={constructor:{value:Challenge},_name:"saslChallenge",_eventname:"sasl:challenge",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"challenge",toString:stanza.toString,toJSON:stanza.toJSON,get value(){return atob(this.xml.textContent)},set value(value){this.xml.textContent=btoa(value)||"="}};function Response(data,xml){return stanza.init(this,xml,data)}Response.prototype={constructor:{value:Response},_name:"saslResponse",_eventname:"sasl:response",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"response",toString:stanza.toString,toJSON:stanza.toJSON,get value(){return atob(this.xml.textContent)},set value(value){this.xml.textContent=btoa(value)||"="}};function Success(data,xml){return stanza.init(this,xml,data)}Success.prototype={constructor:{value:Success},_name:"saslSuccess",_eventname:"sasl:success",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"success",toString:stanza.toString,toJSON:stanza.toJSON,get value(){return atob(this.xml.textContent)},set value(value){this.xml.textContent=btoa(value)||"="}};function Failure(data,xml){return stanza.init(this,xml,data)}Failure.prototype={constructor:{value:Success},_CONDITIONS:["aborted","account-disabled","credentials-expired","encryption-required","incorrect-encoding","invalid-authzid","invalid-mechanism","malformed-request","mechanism-too-weak","not-authorized","temporary-auth-failure"],_name:"saslFailure",_eventname:"sasl:failure",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"failure",toString:stanza.toString,toJSON:stanza.toJSON,get lang(){return this._lang||""},set lang(value){this._lang=value},get condition(){var self=this;var result=[];_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,this.NS,condition);if(exists.length){result.push(exists[0].tagName)}});return result[0]||""},set condition(value){var self=this;_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,self.NS,condition);if(exists.length){self.xml.removeChild(exists[0])}});if(value){var condition=document.createElementNS(this.NS,value);condition.setAttribute("xmlns",this.NS);this.xml.appendChild(condition)}},get text(){var text=this.$text;return text[this.lang]||""},get $text(){return stanza.getSubLangText(this.xml,this.NS,"text",this.lang)},set text(value){stanza.setSubLangText(this.xml,this.NS,"text",value,this.lang)}};function Abort(data,xml){return stanza.init(this,xml,data)}Abort.prototype={constructor:{value:Abort},_name:"saslAbort",_eventname:"sasl:abort",NS:"urn:ietf:params:xml:ns:xmpp-sasl",EL:"abort",toString:stanza.toString,toJSON:stanza.toJSON};stanza.extend(StreamFeatures,Mechanisms,"sasl");stanza.topLevel(Auth);stanza.topLevel(Challenge);stanza.topLevel(Response);stanza.topLevel(Success);stanza.topLevel(Failure);stanza.topLevel(Abort);exports.Mechanisms=Mechanisms;exports.Auth=Auth;exports.Challenge=Challenge;exports.Response=Response;exports.Success=Success;exports.Failure=Failure;exports.Abort=Abort},{"./stanza":2,"./streamFeatures":50,lodash:54}],47:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Iq=require("./iq");function Roster(data,xml){return stanza.init(this,xml,data)}Roster.prototype={constructor:{value:Roster},_name:"roster",NS:"jabber:iq:roster",EL:"query",toString:stanza.toString,toJSON:stanza.toJSON,get ver(){return this.xml.getAttribute("ver")||""},set ver(value){if(value){this.xml.setAttribute("ver",value)}},get items(){var self=this;var items=stanza.find(this.xml,this.NS,"item");if(!items.length){return[]}var results=[];_.each(items,function(item){var data={jid:item.getAttribute("jid")||undefined,_name:item.getAttribute("name")||undefined,subscription:item.getAttribute("subscription")||"none",ask:item.getAttribute("ask")||undefined,groups:[]};
var groups=stanza.find(item,self.NS,"group");_.each(groups,function(group){data.groups.push(group.textContent)});results.push(data)});return results},set items(values){var self=this;_.each(values,function(value){var item=document.createElementNS(self.NS,"item");if(value.jid){item.setAttribute("jid",value.jid)}if(value.name){item.setAttribute("name",value.name)}if(value.subscription){item.setAttribute("subscription",value.subscription)}if(value.ask){item.setAttribute("ask",value.ask)}_.each(value.groups||[],function(name){var group=document.createElementNS(self.NS,"group");group.textContent=name;item.appendChild(group)});self.xml.appendChild(item)})}};stanza.extend(Iq,Roster);module.exports=Roster},{"./stanza":2,"./iq":6,lodash:54}],48:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Message=require("./message"),Presence=require("./presence"),Iq=require("./iq");function Error(data,xml){return stanza.init(this,xml,data)}Error.prototype={constructor:{value:Error},_name:"error",NS:"jabber:client",EL:"error",_ERR_NS:"urn:ietf:params:xml:ns:xmpp-stanzas",_CONDITIONS:["bad-request","conflict","feature-not-implemented","forbidden","gone","internal-server-error","item-not-found","jid-malformed","not-acceptable","not-allowed","not-authorized","payment-required","recipient-unavailable","redirect","registration-required","remote-server-not-found","remote-server-timeout","resource-constraint","service-unavailable","subscription-required","undefined-condition","unexpected-request"],toString:stanza.toString,toJSON:stanza.toJSON,get lang(){if(this.parent){return this.parent.lang}return""},get condition(){var self=this;var result=[];_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,self._ERR_NS,condition);if(exists.length){result.push(exists[0].tagName)}});return result[0]||""},set condition(value){var self=this;_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,self._ERR_NS,condition);if(exists.length){self.xml.removeChild(exists[0])}});if(value){var condition=document.createElementNS(this._ERR_NS,value);condition.setAttribute("xmlns",this._ERR_NS);this.xml.appendChild(condition)}},get gone(){return stanza.getSubText(this.xml,this._ERR_NS,"gone")},set gone(value){this.condition="gone";stanza.setSubText(this.xml,this._ERR_NS,"gone",value)},get redirect(){return stanza.getSubText(this.xml,this._ERR_NS,"redirect")},set redirect(value){this.condition="redirect";stanza.setSubText(this.xml,this._ERR_NS,"redirect",value)},get code(){return this.xml.getAttribute("code")||""},set code(value){this.xml.setAttribute("code",value)},get type(){return this.xml.getAttribute("type")||""},set type(value){this.xml.setAttribute("type",value)},get by(){return this.xml.getAttribute("by")||""},set by(value){this.xml.setAttribute("by",value)},get $text(){return stanza.getSubLangText(this.xml,this._ERR_NS,"text",this.lang)},set text(value){stanza.setSubLangText(this.xml,this._ERR_NS,"text",value,this.lang)},get text(){var text=this.$text;return text[this.lang]||""}};stanza.extend(Message,Error);stanza.extend(Presence,Error);stanza.extend(Iq,Error);module.exports=Error},{"./stanza":2,"./message":4,"./presence":5,"./iq":6,lodash:54}],49:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza");function StreamError(data,xml){return stanza.init(this,xml,data)}StreamError.prototype={constructor:{value:StreamError},_name:"streamError",NS:"http://etherx.jabber.org/streams",EL:"error",_ERR_NS:"urn:ietf:params:xml:ns:xmpp-streams",_CONDITIONS:["bad-format","bad-namespace-prefix","conflict","connection-timeout","host-gone","host-unknown","improper-addressing","internal-server-error","invalid-from","invalid-namespace","invalid-xml","not-authorized","not-well-formed","policy-violation","remote-connection-failed","reset","resource-constraint","restricted-xml","see-other-host","system-shutdown","undefined-condition","unsupported-encoding","unsupported-feature","unsupported-stanza-type","unsupported-version"],toString:stanza.toString,toJSON:stanza.toJSON,get lang(){return this._lang||""},set lang(value){this._lang=value},get condition(){var self=this;var result=[];_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,self._ERR_NS,condition);if(exists.length){result.push(exists[0].tagName)}});return result[0]||""},set condition(value){var self=this;_.each(this._CONDITIONS,function(condition){var exists=stanza.find(self.xml,self._ERR_NS,condition);if(exists.length){self.xml.removeChild(exists[0])}});if(value){var condition=document.createElementNS(this._ERR_NS,value);condition.setAttribute("xmlns",this._ERR_NS);this.xml.appendChild(condition)}},get seeOtherHost(){return stanza.getSubText(this.xml,this._ERR_NS,"see-other-host")},set seeOtherHost(value){this.condition="see-other-host";stanza.setSubText(this.xml,this._ERR_NS,"see-other-host",value)},get text(){var text=this.$text;return text[this.lang]||""},get $text(){return stanza.getSubLangText(this.xml,this._ERR_NS,"text",this.lang)},set text(value){stanza.setSubLangText(this.xml,this._ERR_NS,"text",value,this.lang)}};stanza.topLevel(StreamError);module.exports=StreamError},{"./stanza":2,lodash:54}],61:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Iq=require("./iq"),RSM=require("./rsm"),DataForm=require("./dataforms").DataForm;function DiscoInfo(data,xml){return stanza.init(this,xml,data)}DiscoInfo.prototype={constructor:{value:DiscoInfo},_name:"discoInfo",NS:"http://jabber.org/protocol/disco#info",EL:"query",toString:stanza.toString,toJSON:stanza.toJSON,get node(){return this.xml.getAttribute("node")||""},set node(value){if(!value){this.xml.removeAttribute("node")}else{this.xml.setAttribute("node",value)}},get identities(){var result=[];var identities=stanza.find(this.xml,this.NS,"identity");_.each(identities,function(identity){result.push({category:identity.getAttribute("category"),type:identity.getAttribute("type"),lang:identity.getAttributeNS(stanza.XML_NS,"lang"),_name:identity.getAttribute("name")})});return result},set identities(values){var self=this;var existing=stanza.find(this.xml,this.NS,"identity");_.each(existing,function(item){this.xml.removeChild(item)});_.each(values,function(value){var identity=document.createElementNS(self.NS,"identity");if(value.category){identity.setAttribute("category",value.category)}if(value.type){identity.setAttribute("type",value.type)}if(value.name){identity.setAttribute("name",value.name)}if(value.lang){identity.setAttributeNS(stanza.XML_NS,"lang",value.lang)}self.xml.appendChild(identity)})},get features(){var result=[];var features=stanza.find(this.xml,this.NS,"feature");_.each(features,function(feature){result.push(feature.getAttribute("var"))});return result},set features(values){var self=this;var existing=stanza.find(this.xml,this.NS,"feature");_.each(existing,function(item){self.xml.removeChild(item)});_.each(values,function(value){var feature=document.createElementNS(self.NS,"feature");feature.setAttribute("var",value);self.xml.appendChild(feature)})},get extensions(){var self=this,result=[];var forms=stanza.find(this.xml,DataForm.NS,DataForm.EL);_.forEach(forms,function(form){var ext=new DataForm({},form);result.push(ext.toJSON())})},set extensions(value){var self=this;var forms=stanza.find(this.xml,DataForm.NS,DataForm.EL);_.forEach(forms,function(form){self.xml.removeChild(form)});_.forEach(value,function(ext){var form=new DataForm(ext);self.xml.appendChild(form.xml)})}};function DiscoItems(data,xml){return stanza.init(this,xml,data)}DiscoItems.prototype={constructor:{value:DiscoInfo},_name:"discoItems",NS:"http://jabber.org/protocol/disco#items",EL:"query",toString:stanza.toString,toJSON:stanza.toJSON,get node(){return this.xml.getAttribute("node")||""},set node(value){this.xml.setAttribute("node",value)},get items(){var result=[];var items=stanza.find(this.xml,this.NS,"item");_.each(items,function(item){result.push({jid:item.getAttribute("jid"),node:item.getAttribute("node"),_name:item.getAttribute("name")})});return result},set items(values){var self=this;var existing=stanza.find(this.xml,this.NS,"item");_.each(existing,function(item){self.xml.removeChild(item)});_.each(values,function(value){var item=document.createElementNS(self.NS,"item");if(value.jid){item.setAttribute("jid",value.jid)}if(value.node){item.setAttribute("node",value.node)}if(value.name){item.setAttribute("name",value.name)}self.xml.appendChild(item)})}};stanza.extend(Iq,DiscoInfo);stanza.extend(Iq,DiscoItems);stanza.extend(DiscoItems,RSM);exports.DiscoInfo=DiscoInfo;exports.DiscoItems=DiscoItems},{"./stanza":2,"./iq":6,"./rsm":58,"./dataforms":63,lodash:54}],63:[function(require,module,exports){var _=require("lodash"),stanza=require("./stanza"),Message=require("./message");function DataForm(data,xml){return stanza.init(this,xml,data)}DataForm.prototype={constructor:{value:DataForm},NS:"jabber:x:data",EL:"x",_name:"form",toString:stanza.toString,toJSON:stanza.toJSON,get title(){return stanza.getSubText(this.xml,this.NS,"title")},set title(value){stanza.setSubText(this.xml,this.NS,"title",value)},get instructions(){return stanza.getMultiSubText(this.xml,this.NS,"title").join("\n")},set instructions(value){stanza.setMultiSubText(this.xml,this.NS,"title",value.split("\n"))},get type(){return this.xml.getAttribute("type")||"form"},set type(value){this.xml.setAttribute("type",value)},get fields(){var fields=stanza.find(this.xml,this.NS,"field"),results=[];_.forEach(fields,function(field){results.push(new Field({},field).toJSON())});return results},set fields(value){var self=this;_.forEach(value,function(field){self.addField(field)})},addField:function(opts){var field=new Field(opts);this.xml.appendChild(field.xml)}};function Field(data,xml){stanza.init(this,xml,data);this._type=data.type||this.type;return this}Field.prototype={constructor:{value:Field},NS:"jabber:x:data",EL:"field",toString:stanza.toString,toJSON:stanza.toJSON,get type(){return this.xml.getAttribute("type")||"text-single"},set type(value){this._type=value;this.xml.setAttribute("type",value)},get name(){return this.xml.getAttribute("var")||""},set name(value){this.xml.setAttribute("var",value)},get desc(){return stanza.getSubText(this.xml,this.NS,"desc")},set desc(value){stanza.setSubText(this.xml,this.NS,"desc",value)},get value(){var vals=stanza.getMultiSubText(this.xml,this.NS,"value");if(this._type==="boolean"){return vals[0]==="1"||vals[0]==="true"}if(vals.length>1){if(this._type==="text-multi"){return vals.join("\n")}return vals}return vals[0]},set value(value){if(this._type==="boolean"){stanza.setSubText(this.xml,this.NS,"value",value?"1":"0")}else{if(this._type==="text-multi"){value=value.split("\n")}stanza.setMultiSubText(this.xml,this.NS,"value",value)}},get required(){var req=stanza.find(this.xml,this.NS,"required");return req.length>0},set required(value){var reqs=stanza.find(this.xml,this.NS,"required");if(value&&reqs.length===0){var req=document.createElementNS(this.NS,"required");this.xml.appendChild(req)}else if(!value&&reqs.length>0){_.forEach(reqs,function(req){this.xml.removeChild(req)})}},get label(){return this.xml.getAttribute("label")||""},set label(value){this.xml.setAttribute("label",value)},get options(){var self=this;return stanza.getMultiSubText(this.xml,this.NS,"option",function(sub){return stanza.getSubText(sub,self.NS,"value")})},set options(value){var self=this;stanza.setMultiSubText(this.xml,this.NS,"option",value,function(val){var opt=document.createElementNS(self.NS,"option"),value=document.createElementNS(self.NS,"value");opt.appendChild(value);value.textContent=val;self.xml.appendChild(opt)})}};stanza.extend(Message,DataForm);exports.DataForm=DataForm;exports.Field=Field},{"./stanza":2,"./message":4,lodash:54}]},{},[1])(1)});